<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="0156e8cb-c1d0-4491-a148-78ee3552afc7" discardOkResults="false" failOnError="true" failTestCaseOnErrors="true" keepSession="false" name="RCR658" searchProperties="true" timeout="0" xmlns:con="http://eviware.com/soapui/config">
  <con:settings>
    <con:setting id="5a5fc65e-710a-4353-b774-e19e85d48635fileName">NBR</con:setting>
    <con:setting id="0156e8cb-c1d0-4491-a148-78ee3552afc7fileName">RCR658</con:setting>
  </con:settings>
  <con:savedRecentRuns>1</con:savedRecentRuns>
  <con:testStep type="groovy" name="Initialise_Properties" id="4a2b31e9-ba75-4232-949c-e0bdc01d98ce">
    <con:settings/>
    <con:config>
      <script>// initialise values
testRunner.testCase.setPropertyValue( 'TotalOfValuesChecked',  '0')
testRunner.testCase.setPropertyValue( 'NumOfIterations',  '0')


//Creates outout file
now=new java.text.SimpleDateFormat("yyyyMMdd'T'HHmmss").format(new Date())

testRunner.testCase.setPropertyValue( 'ResultFile',("N:/Systems_development/RIO/Road MTA-CR-242/Soap UI/Test Results/RCR-658/Results" + now + ".txt"));
FileOutputStream out1 = new FileOutputStream(context.expand( '${#TestCase#ResultFile}' ));
out1.write();
out1.close();</script>
    </con:config>
  </con:testStep>
  <con:testStep type="datasource" name="658All" id="f601b2e7-dadc-409a-aaa2-808be91a1c31">
    <con:settings>
      <con:setting id="com.eviware.soapui.impl.wsdl.teststeps.datasource.DataSourceContainer@prepared-properties">&lt;xml-fragment/></con:setting>
    </con:settings>
    <con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:dataSource type="Excel">
        <con:configuration>
          <file>N:/Systems_development/RIO/Road MTA-CR-242/Soap Pricing/RCR-658/RCR-658_InputSheet Edited.xlsx</file>
          <worksheet>MTA</worksheet>
          <cell>A2</cell>
          <ignoreEmpty>false</ignoreEmpty>
          <evaluateFormulas>false</evaluateFormulas>
        </con:configuration>
      </con:dataSource>
      <con:shared>false</con:shared>
      <con:restartShared>false</con:restartShared>
      <con:property>ID</con:property>
      <con:property>Scenario</con:property>
      <con:property>ExProduct</con:property>
      <con:property>EXBRC</con:property>
      <con:property>ExCover_type</con:property>
      <con:property>EXCar1</con:property>
      <con:property>EXCar2</con:property>
      <con:property>EXCar3</con:property>
      <con:property>EXCar4</con:property>
      <con:property>U17_ASSOCIATE</con:property>
      <con:property>POLICYSTARTDATE</con:property>
      <con:property>POLICYENDDATE</con:property>
      <con:property>MTA Date</con:property>
      <con:property>FlexFactor</con:property>
      <con:property>Payment type</con:property>
      <con:property>COOLINGOFF FLAG_RO</con:property>
      <con:property>COOLINGOFF FLAG_RE</con:property>
      <con:property>COOLINGOFF FLAG_HS</con:property>
      <con:property>COOLINGOFF FLAG_SM</con:property>
      <con:property>COOLINGOFF FLAG_BRC</con:property>
      <con:property>ProrataMore</con:property>
      <con:property>ProrataLess</con:property>
      <con:property>Persistent Offer</con:property>
      <con:property>Renewal Offer</con:property>
      <con:property>RNL AD</con:property>
      <con:property>AGENT_DISCOUNT_TYPE_1</con:property>
      <con:property>AGENT_DISCOUNT_VALUE_1</con:property>
      <con:property>AGENT_DISCOUNT_TYPE_2</con:property>
      <con:property>AGENT_DISCOUNT_VALUE_2</con:property>
      <con:property>NewProduct</con:property>
      <con:property>NewBRC</con:property>
      <con:property>NewCover_type</con:property>
      <con:property>NewCar1</con:property>
      <con:property>NewCar2</con:property>
      <con:property>NewCar3</con:property>
      <con:property>NewCar4</con:property>
      <con:property>MTA Offer</con:property>
      <con:property>MTA AD</con:property>
      <con:property>MTAAGENT_DISCOUNT_TYPE_1</con:property>
      <con:property>MTAAGENT_DISCOUNT_VALUE_1</con:property>
      <con:property>MTAAGENT_DISCOUNT_TYPE_2</con:property>
      <con:property>MTAAGENT_DISCOUNT_VALUE_2</con:property>
      <con:property>MTA System Discount</con:property>
      <con:property>Multiplying Factor</con:property>
      <con:property>PaidPeriod_RO</con:property>
      <con:property>PaidPeriod_RE</con:property>
      <con:property>PaidPeriod_SM</con:property>
      <con:property>PaidPeriod_HS</con:property>
      <con:property>PaidPeriod_BRC</con:property>
      <con:startRow>0</con:startRow>
      <con:endRow/>
      <con:recordsPerIteration>1</con:recordsPerIteration>
      <con:completeLastOperation>false</con:completeLastOperation>
      <con:trimValues>false</con:trimValues>
      <con:entitizeValues>false</con:entitizeValues>
      <con:restartOnRun>true</con:restartOnRun>
      <con:expandProperties>false</con:expandProperties>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="TestRun" id="e8773466-0f7d-4e18-ac31-c1f439618fc3" disabled="true">
    <con:settings/>
    <con:config>
      <script>def project = testRunner.testCase.testSuite.project;

//testRunner.testCase.setPropertyValue('payment','CMM');

testRunner.runTestStep( project.testSuites['RCR658'].testCases['RCR658'].testSteps['Setup_658_ProductList_XML'] );
testRunner.runTestStep( project.testSuites['RCR658'].testCases['RCR658'].testSteps['Setup_658_Cover_Value'] );
testRunner.runTestStep( project.testSuites['RCR658'].testCases['RCR658'].testSteps['Call'] );
testRunner.runTestStep( project.testSuites['RCR658'].testCases['RCR658'].testSteps['Setup_658_New_ProductList_XML'] );
testRunner.runTestStep( project.testSuites['RCR658'].testCases['RCR658'].testSteps['Setup_658_NewCover_Value'] );
testRunner.runTestStep( project.testSuites['RCR658'].testCases['RCR658'].testSteps['Setup_658_NewAgentDiscount_XML'] );
testRunner.runTestStep( project.testSuites['RCR658'].testCases['RCR658'].testSteps['Setup_658_CurrentPolicyPrice'] );
testRunner.runTestStep( project.testSuites['RCR658'].testCases['RCR658'].testSteps['Setup_658_TransPolicyPrice'] );
testRunner.runTestStep( project.testSuites['RCR658'].testCases['RCR658'].testSteps['658Request'] );</script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Setup_658_ProductList_XML" id="93f3fe03-4753-4dea-8938-6d5ff477cec6">
    <con:settings/>
    <con:config>
      <script><![CDATA[def ExproductType = context.expand( '${658All#ExProduct}' )

String delimiters = "\\,|\\&()";
String[] prodArr = ExproductType.split(delimiters);
StringBuilder strBld = new StringBuilder();
StringBuilder strBld2 = new StringBuilder();
StringBuilder strBld3 = new StringBuilder();

if(prodArr.length > 0)
{
	for (prod in prodArr)
	{
		strBld.append("<gen:Product>");
		strBld.append("<prod:ProductCode>");
		if(prod.trim().equals("Roadside"))
		{
			if(context.expand( '${658All#ExCover_type}' ) =="V1")
				{
					strBld.append("PRD_UK_0002");
					strBld2.append("PRD_UK_0002");
					strBld3.append("Roadside");
				}
				else
				{
					strBld.append("PRD_UK_0001");
					strBld2.append("PRD_UK_0001");
					strBld3.append("Roadside");
				}
		}
		if(prod.trim().equals("Basic Breakdown Cover"))
		{
			strBld.append("PRD_UK_0020");
			strBld2.append("PRD_UK_0020");
			strBld3.append("BasicBreakdown");
		}
		if(prod.trim().equals("ROCO"))
		{
			strBld.append("PRD_UK_0021");
			strBld2.append("PRD_UK_0021");
			strBld3.append("ROCO");
		}
		if(prod.trim().equals("ROPOV"))
		{
			strBld.append("PRD_UK_0023");
			strBld2.append("PRD_UK_0023");
			strBld3.append("ROPOV");
		}
		if(prod.trim().equals("Local Driver"))
		{
			strBld.append("PRD_UK_0022");			
			strBld2.append("PRD_UK_0022");
			strBld3.append("LocalDriver");
		}
		if(prod.trim().equals("Standby"))
		{
			strBld.append("PRD_UK_0030");
			strBld2.append("PRD_UK_0030");
			strBld3.append("Standby");
		}
		if(prod.trim().equals("Start Up"))
		{
			strBld.append("PRD_UK_0024");
			strBld2.append("PRD_UK_0024");
			strBld3.append("StartUp");
		}
		if(prod.trim().equals("Home Start"))
		{
			strBld.append("PRD_UK_0003");
		}
		if(prod.trim().equals("Relay"))
		{
			strBld.append("PRD_UK_0004");
		}
		if(prod.trim().equals("Stay Mobile") ||prod.trim().equals("Staymobile") )
		{
			strBld.append("PRD_UK_0005");
		}		
		strBld.append("</prod:ProductCode>");
		strBld.append("</gen:Product>");
	}
	
}
if(context.expand('${658All#NewBRC}').equals("Y"))
{
	strBld.append("<gen:Product><prod:ProductCode>PRD_UK_0018</prod:ProductCode></gen:Product>");
	strBld.append("<gen:VehicleAgeList>")
		if (context.expand( '${658All#ExCar1}' ) != "")
		{
			strBld.append("<prod:VehicleAge>"+context.expand( '${658All#ExCar1}' )+"</prod:VehicleAge>")
		}
		if (context.expand( '${658All#ExCar2}' ) != "")
		{
			strBld.append("<prod:VehicleAge>"+context.expand( '${658All#ExCar2}' )+"</prod:VehicleAge>")
		}
		if (context.expand( '${658All#ExCar3}' ) != "")
		{
			strBld.append("<prod:VehicleAge>"+context.expand( '${658All#ExCar3}' )+"</prod:VehicleAge>")
		}
		if (context.expand( '${658All#ExCar4}' ) != "")
		{
			strBld.append("<prod:VehicleAge>"+context.expand( '${658All#ExCar4}' )+"</prod:VehicleAge>")
		}
           strBld.append("</prod:VehicleAgeList>")
}
taxtype="I";
testRunner.testCase.setPropertyValue( "ProductList_XML",  strBld.toString()) //sends nodes in Request
testRunner.testCase.setPropertyValue( "RoadList",  strBld2.toString()) //sets ROADSIDE string in Validation
testRunner.testCase.setPropertyValue( "RoadNameList",  strBld3.toString()) //sets NAME string in Validation
testRunner.testCase.setPropertyValue( "TaxType",  taxtype.toString())
log.info(strBld)
log.info(strBld2)
log.info(strBld3)]]></script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Setup_658_Cover_Value" id="78b1056d-23ea-4c0a-9473-1ea998bbdee2">
    <con:settings/>
    <con:config>
      <script>def cover = context.expand( '${658All#ExCover_type}' )

String coverToUse = "";

if(cover.equals("V1"))
{
	coverToUse = "0";
}
if(cover.equals("P1"))
{
	coverToUse = "1";
}
if(cover.equals("P2"))
{
	coverToUse = "2";
}
if(cover.equals("P3"))
{
	coverToUse = "3";
}
if(cover.equals("P4"))
{
	coverToUse = "4";
}

testRunner.testCase.setPropertyValue( "Cover",  coverToUse)
log.info(coverToUse)</script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Setup_658_AgentDiscount_XML" id="5421d82d-812d-4323-b99e-4c33c5c397e1">
    <con:settings/>
    <con:config>
      <script><![CDATA[def payment = context.expand( '${658All#Payment type}' )

StringBuilder strBld = new StringBuilder();
StringBuilder strBld2 = new StringBuilder();
def OldAD = context.expand( '${658All#RNL AD}' )

if(OldAD !="")
{
	def x 
		//def AgentDiscountValue
	def d = Integer.parseInt(OldAD); 
	log.info(d)
	if (d != 0)
	{
		strBld.append("<prod:AgentDiscountRequestedList>");
		for( int i=1 ; i<=d; i++  ) 
		{
			if(context.expand('${658All#AGENT_DISCOUNT_VALUE_' + i + '}') == "")
			{
				strBld.append("")
			}
			else
			{
				def Type = context.expand('${658AllRoadAll#AGENT_DISCOUNT_TYPE_' + i + '}')
				
				AgentDiscountValue = context.expand('${658All#AGENT_DISCOUNT_VALUE_' + i + '}')
				log.info AgentDiscountValue
				log.info(AgentDiscountValue + d )
			
				new_code="ABI"+i+"C"
				strBld.append("<prod:AgentDiscountRequested>");
				//strBld.append("<prod:AgentDiscountCode>" + context.expand('${242RoadAll#AGENT_DISCOUNT_CODE_' + i + '}') + "</prod:AgentDiscountCode>");
				strBld.append("<prod:AgentDiscountCode>" + new_code + "</prod:AgentDiscountCode>");
				strBld.append("<prod:AgentDiscountType>" + context.expand('${658All#AGENT_DISCOUNT_TYPE_' + i + '}') + "</prod:AgentDiscountType>");
				strBld.append("<prod:AgentDiscountValue>" + AgentDiscountValue + "</prod:AgentDiscountValue>");
				strBld.append("</prod:AgentDiscountRequested>");
				x = i
			}
		}
		strBld.append("</prod:AgentDiscountRequestedList>");  
	}
	
	strBld2.append(x)
	log.info(strBld)
	log.info(strBld2)
	testRunner.testCase.setPropertyValue( "AgentDiscount_XML", strBld.toString())
	testRunner.testCase.setPropertyValue( "AgentDiscountsApplied", strBld2.toString())
}
else
{
	log.info("no discounts")
}]]></script>
    </con:config>
  </con:testStep>
  <con:testStep type="request" id="7f0dfa33-f817-4c34-9c3e-10af7ebd630f" name="RenewalE2E">
    <con:settings/>
    <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:interface>SOAPServiceBindingRNL</con:interface>
      <con:operation>GenerateQuote</con:operation>
      <con:request name="RenewalE2E" id="ee2a69d2-b309-443e-a695-e7fc15cd5e91">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:endpoint>http://rh0124v:18047/SOAPServiceBinding/BSROS_GenerateQuote_RNL/</con:endpoint>
        <con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:gen="http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3" xmlns:mes="http://www.theaa.com/CommonServices/Data/Message/MessageHeader.2" xmlns:com="http://www.theaa.com/CommonServices/Data/Common" xmlns:prod="http://www.theaa.com/CommonServices/Data/Product.2" xmlns:mem="http://www.theaa.com/CommonServices/Data/Membership.2" xmlns:veh="http://www.theaa.com/CommonServices/Data/General/Vehicle">\r
   <soapenv:Header/>\r
   <soapenv:Body>\r
      <gen:GenerateQuoteRequest>\r
         <mes:RequestHeader>\r
            <mes:TransactionId>RNLQ-1903-666</mes:TransactionId>\r
            <mes:Version>1.0</mes:Version>\r
            <mes:RequestDateTime>2020-01-26T00:00:00</mes:RequestDateTime>\r
            <mes:Source>\r
               <mes:Domain>SALES</mes:Domain>\r
               <mes:Channel>SanityTesting</mes:Channel>\r
               <mes:LineOfBusiness>ROS</mes:LineOfBusiness>\r
               <mes:Name>Pricing Services</mes:Name>\r
               <mes:User>PS Testing</mes:User>\r
            </mes:Source>\r
         </mes:RequestHeader>\r
         <gen:IndicativePriceFlag>false</gen:IndicativePriceFlag>\r
         <gen:CurrentFlexDetails>\r
            <prod:FlexFactorOnCurrentPolicy>1</prod:FlexFactorOnCurrentPolicy>\r
         </gen:CurrentFlexDetails>\r
         <gen:RenewalFlexDetails>\r
            <prod:FlexFactor>${658All#FlexFactor}</prod:FlexFactor>\r
            <prod:FlexFactorCalculatedFlag>true</prod:FlexFactorCalculatedFlag>\r
         </gen:RenewalFlexDetails>\r
         <!--gen:PaymentType>${#TestCase#payment}</gen:PaymentType-->\r
         <gen:PaymentType>${658All#Payment type}</gen:PaymentType>

         <gen:ProductList>\r
            <prod:EffectivePriceDateTime>${658All#POLICYSTARTDATE}T00:00:00</prod:EffectivePriceDateTime>\r
            <prod:PolicyStartDateTime>${658All#POLICYSTARTDATE}T00:00:00</prod:PolicyStartDateTime>\r
            <prod:PolicyEndDateTime>${658All#POLICYENDDATE}T00:00:00</prod:PolicyEndDateTime>\r
            <prod:OfferCodeDetailList>\r
               <prod:OfferCodeDetail>\r
                  <!--prod:OfferCode>${658All#OFFER_CODE}</prod:OfferCode-->\r
                  <prod:OfferCode>${658All#Persistent Offer}</prod:OfferCode>
                  <prod:OfferCodeApplicationLevel>1</prod:OfferCodeApplicationLevel>\r
                  <prod:IsPersistent>true</prod:IsPersistent>
               </prod:OfferCodeDetail>\r
                <prod:OfferCodeDetail>
                  <prod:OfferCode>${658All#Renewal Offer}</prod:OfferCode>
                  <prod:OfferCodeApplicationLevel>1</prod:OfferCodeApplicationLevel>
                  <prod:IsPersistent>false</prod:IsPersistent>
               </prod:OfferCodeDetail>

            </prod:OfferCodeDetailList>\r
            <prod:SourceGroup>15</prod:SourceGroup>\r
            <prod:SourceCode>W1037</prod:SourceCode>\r
            <prod:Currency>GBP</prod:Currency>\r
            <gen:MembershipTenure>1</gen:MembershipTenure>\r
            ${#TestCase#ProductList_XML}\r
            <gen:CoveredPersons>${#TestCase#Cover}</gen:CoveredPersons>\r
            ${#TestCase#AgentDiscount_XML}
         </gen:ProductList>\r
         <gen:CustomerDetails>\r
            <gen:Postcode>RG214EA</gen:Postcode>\r
            <mem:MembershipNumber>6356011512658868</mem:MembershipNumber>\r
         </gen:CustomerDetails>\r
         <gen:RenewalRiskData>\r
            <gen:PartialFreeMembershipFlag>false</gen:PartialFreeMembershipFlag>\r
            <gen:RecordedPaymentType>RAP</gen:RecordedPaymentType>\r
            <gen:RecordedPaymentMeans>DD</gen:RecordedPaymentMeans>\r
            <gen:InScopeFlexFlag>true</gen:InScopeFlexFlag>\r
            <gen:OptInOfferFlag>true</gen:OptInOfferFlag>\r
         </gen:RenewalRiskData>\r
         <gen:CurrentPolicyDetails>\r
            <prod:PaymentType>RAP</prod:PaymentType>\r
            <prod:PolicyStartDateTime>2020-07-10T00:00:00</prod:PolicyStartDateTime>\r
            <prod:PolicyEndDateTime>2021-07-09T00:00:00</prod:PolicyEndDateTime>\r
            <prod:CoveredPersons>4</prod:CoveredPersons>\r
            <prod:Currency>GBP</prod:Currency>\r
            <gen:Product>\r
               <prod:ProductCode>PRD_UK_0011</prod:ProductCode>\r
               <prod:ProductPriceName>Roadside</prod:ProductPriceName>\r
               <gen:PriceList>\r
                  <prod:PolicyPrice>\r
                     <prod:PriceElementType/>\r
                     <prod:PriceBreakdown>\r
                        <prod:CorePrice>\r
                           <prod:NetRate>0.0</prod:NetRate>\r
                           <prod:NetRateTax>0.0</prod:NetRateTax>\r
                           <prod:Commission>102.54</prod:Commission>\r
                           <prod:CommissionTax>12.3</prod:CommissionTax>\r
                           <prod:InternallyFundedDiscount>0.0</prod:InternallyFundedDiscount>\r
                           <prod:TaxPercentage>0.12</prod:TaxPercentage>\r
                           <prod:TaxTotal>12.3</prod:TaxTotal>\r
                           <prod:Total>114.84</prod:Total>\r
                        </prod:CorePrice>\r
                        <prod:ArrangementFee>\r
                           <prod:Fee>44.88</prod:Fee>\r
                           <prod:FeeTax>0.0</prod:FeeTax>\r
                           <prod:InternallyFundedDiscount>0.0</prod:InternallyFundedDiscount>\r
                           <prod:TaxPercentage>0.12</prod:TaxPercentage>\r
                           <prod:Total>44.88</prod:Total>\r
                        </prod:ArrangementFee>\r
                        <prod:AccountingTotals>\r
                           <prod:CoreDiscountsTotal>0.0</prod:CoreDiscountsTotal>\r
                           <prod:CoreDiscountsTaxTotal>0.0</prod:CoreDiscountsTaxTotal>\r
                           <prod:CoreCommissionDiscountsTotal>0.0</prod:CoreCommissionDiscountsTotal>\r
                           <prod:CoreNetRateDiscountsTotal>0.0</prod:CoreNetRateDiscountsTotal>\r
                           <prod:ArrangementFeeGrandDiscountsTotal>0.0</prod:ArrangementFeeGrandDiscountsTotal>\r
                           <prod:ArrangementFeeTaxDiscountsTotal>0.0</prod:ArrangementFeeTaxDiscountsTotal>\r
                           <prod:ArrangementFeeDiscountsTotal>0.0</prod:ArrangementFeeDiscountsTotal>\r
                        </prod:AccountingTotals>\r
                     </prod:PriceBreakdown>\r
                     <prod:TaxType>I</prod:TaxType>\r
                     <prod:TaxDate>2020-07-10T00:00:00</prod:TaxDate>\r
                     <prod:DateInceptedOnPolicy>2020-07-10T00:00:00</prod:DateInceptedOnPolicy>\r
                     <prod:RelativityPriceFactor>1.0</prod:RelativityPriceFactor>\r
                     <prod:ExtrapolationFactor>1.0</prod:ExtrapolationFactor>\r
                     <prod:ArrangementFeeTotal>44.88</prod:ArrangementFeeTotal>\r
                     <prod:TotalLessArrangementFeeTotal>114.84</prod:TotalLessArrangementFeeTotal>\r
                     <prod:TotalLessDiscounts>159.72</prod:TotalLessDiscounts>\r
                     <prod:Total>159.72</prod:Total>\r
                  </prod:PolicyPrice>\r
               </gen:PriceList>\r
            </gen:Product>\r
         </gen:CurrentPolicyDetails>\r
      </gen:GenerateQuoteRequest>\r
   </soapenv:Body>\r
</soapenv:Envelope>]]></con:request>
        <con:assertion type="Valid HTTP Status Codes" id="402668d8-cb01-48e4-961a-a0158986ebf3" name="Valid HTTP Status Codes" disabled="true">
          <con:settings/>
          <con:configuration>
            <codes>200</codes>
          </con:configuration>
        </con:assertion>
        <con:assertion type="SOAP Fault Assertion" id="f72160ce-122b-4453-a59e-0977012f98ce" name="Not SOAP Fault" disabled="true"/>
        <con:assertion type="Schema Compliance" id="69cdeab5-b554-4ec1-88cd-e026cc0bec7c" name="Schema Compliance">
          <con:configuration/>
        </con:assertion>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:wsaConfig action="GenerateQuote" mustUnderstand="NONE" version="200508"/>
        <con:wsrmConfig version="1.2"/>
      </con:request>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Setup_658_New_ProductList_XML" id="167330e0-f583-4647-a8ef-825f715c94ed">
    <con:settings/>
    <con:config>
      <script><![CDATA[def newProduct = context.expand( '${658All#NEWPRODUCT}' )

String delimiters = "\\,|\\&";
String[] prodArr = newProduct.split(delimiters);
StringBuilder strBld = new StringBuilder();

if(prodArr.length > 0)
{
	for (prod in prodArr)
	{
		strBld.append("<gen:Product>");
	
		if(prod.trim().equals("Roadside"))
		{
				if (context.expand( '${658All#NewCover_type}' ) == 'V1')
				{
					strBld.append("<prod:ProductCode>PRD_UK_0002</prod:ProductCode>");
				}
				else
				{
					strBld.append("<prod:ProductCode>PRD_UK_0001</prod:ProductCode>");
				}
		}
		if(prod.trim().equals("Home Start"))
		{
			strBld.append("<prod:ProductCode>PRD_UK_0003</prod:ProductCode>");
		}
		if(prod.trim().equals("Relay"))
		{
			strBld.append("<prod:ProductCode>PRD_UK_0004</prod:ProductCode>");
		}
		if(prod.trim().equals("Stay Mobile"))
		{
			strBld.append("<prod:ProductCode>PRD_UK_0005</prod:ProductCode>");
		}		
		
		strBld.append("</gen:Product>");
	}
	if (context.expand('${658All#NewBRC}').equals("Y"))
	{
		strBld.append("<gen:Product><prod:ProductCode>PRD_UK_0018</prod:ProductCode></gen:Product>");
		strBld.append("<prod:VehicleAgeList>")
		if (context.expand( '${658All#NewCar1}' ) != "")
		{
			strBld.append("<prod:VehicleAge>"+context.expand( '${658All#NewCar1}' )+"</prod:VehicleAge>")
		}
		if (context.expand( '${658All#NewCar2}' ) != "")
		{
			strBld.append("<prod:VehicleAge>"+context.expand( '${658All#NewCar2}' )+"</prod:VehicleAge>")
		}
		if (context.expand( '${658All#NewCar3}' ) != "")
		{
			strBld.append("<prod:VehicleAge>"+context.expand( '${658All#NewCar3}' )+"</prod:VehicleAge>")
		}
		if (context.expand( '${658All#NewCar4}' ) != "")
		{
			strBld.append("<prod:VehicleAge>"+context.expand( '${658All#NewCar4}' )+"</prod:VehicleAge>")
		}
           strBld.append("</prod:VehicleAgeList>")
	}
}
taxtype="I";
testRunner.testCase.setPropertyValue( "MTA1_New_ProductList_XML",  strBld.toString()) //sends nodes in Request
//testRunner.testCase.setPropertyValue( "RoadList",  strBld2.toString()) //sets ROADSIDE string in Validation
//testRunner.testCase.setPropertyValue( "RoadNameList",  strBld3.toString()) //sets NAME string in Validation
testRunner.testCase.setPropertyValue( "TaxType",  taxtype.toString())
log.info(strBld)]]></script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Setup_658_NewCover_Value" id="42a7cb15-fe5b-4eb9-8587-dbcfad6e9908">
    <con:settings/>
    <con:config>
      <script>def cover = context.expand( '${658All#NewCover_type}' )

String coverToUse = "";

if(cover.equals("V1"))
{
	coverToUse = "0";
}
if(cover.equals("P1"))
{
	coverToUse = "1";
}
if(cover.equals("P2"))
{
	coverToUse = "2";
}
if(cover.equals("P3"))
{
	coverToUse = "3";
}
if(cover.equals("P4"))
{
	coverToUse = "4";
}

testRunner.testCase.setPropertyValue( "MTA1NEWCover",  coverToUse)
log.info(coverToUse)</script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Setup_658_NewAgentDiscount_XML" id="3275675a-1dec-4414-93d4-b29fc9981f79">
    <con:settings/>
    <con:config>
      <script><![CDATA[StringBuilder strBld = new StringBuilder();
StringBuilder strBld2 = new StringBuilder();
def x 
//def AgentDiscountValue
def check_MTA_AD = context.expand('${658All#MTA AD}')
if (check_MTA_AD=="")
{
log.info "No MTA AD"
}
else
{
def d = Integer.parseInt(context.expand('${658All#MTA AD}')); 
if (d != 0)
{
	strBld.append("<prod:AgentDiscountRequestedList>");
	for( int i=1 ; i<=d; i++  ) 
	{
		if(context.expand('${658All#MTAAGENT_DISCOUNT_VALUE_' + i + '}') == "")
		{
			strBld.append("")
		}
		else
		{
			def Type = context.expand('${658All#MTAAGENT_DISCOUNT_TYPE_' + i + '}')
			
			AgentDiscountValue = context.expand('${658All#MTAAGENT_DISCOUNT_VALUE_' + i + '}')
			log.info AgentDiscountValue
			log.info(AgentDiscountValue + d )
			new_code="MTA"+i+"c"
			strBld.append("<prod:AgentDiscountRequested>");
			//strBld.append("<prod:AgentDiscountCode>" + context.expand('${242RoadAll#AGENT_DISCOUNT_CODE_' + i + '}') + "</prod:AgentDiscountCode>");
			strBld.append("<prod:AgentDiscountCode>" + new_code + "</prod:AgentDiscountCode>");
			strBld.append("<prod:AgentDiscountType>" + context.expand('${658All#MTAAGENT_DISCOUNT_TYPE_' + i + '}') + "</prod:AgentDiscountType>");
			strBld.append("<prod:AgentDiscountValue>" + AgentDiscountValue + "</prod:AgentDiscountValue>");
			strBld.append("</prod:AgentDiscountRequested>");
			x = i
		}
	}
	strBld.append("</prod:AgentDiscountRequestedList>");  
}}
//else
//{
//	strBld.append("")
//}
strBld2.append(x)
log.info(strBld)
log.info(strBld2)
testRunner.testCase.setPropertyValue( "MTAAgentDiscount_XML", strBld.toString())
//testRunner.testCase.setPropertyValue( "AgentDiscountsApplied", strBld2.toString())]]></script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Setup_658_CurrentPolicyPrice" id="a104c19b-6696-4241-b853-91a672103f71">
    <con:settings/>
    <con:config>
      <script><![CDATA[def productType = context.expand( '${658All#ExProduct}' )
def cover = context.expand( '${658All#ExCover_type}' )

String delimiters = "\\,|\\&";
String[] prodArr = productType.split(delimiters);
StringBuilder Strbld = new StringBuilder()

if(prodArr.length > 0)
{	

	for (prod in prodArr)
	{
			
		if(prod.trim().equals("Roadside"))
		{
			product="Roadside"
			Code="RO"
			
			if(cover.equals("V1"))
			{
				Productcode = "PRD_UK_0002"
			}
			else
			{
				Productcode = "PRD_UK_0001"
			}
			strBldS = func_AddProduct(Productcode,product,Code)
			Strbld.append(strBldS)
		}
		
		if(prod.trim().equals("HomeStart")||prod.trim().equals("Home Start"))
		{
			product= "HomeStart"
			Code="HS"
			Productcode = "PRD_UK_0003"
			strBldS = func_AddProduct(Productcode,product,Code)
			Strbld.append(strBldS)
		}
		if(prod.trim().equals("Relay"))
		{
			product= "Relay"
			Code="RE"
			Productcode = "PRD_UK_0004"
			strBldS = func_AddProduct(Productcode,product,Code)
			Strbld.append(strBldS)
		}
		if(prod.trim().equals("StayMobile")||prod.trim().equals("Stay Mobile"))
		{
			product= "StayMobile"
			Code="SM"
			Productcode = "PRD_UK_0005"
			strBldS = func_AddProduct(Productcode,product,Code)
			Strbld.append(strBldS)
		}
		
	}
	if(context.expand( '${658All#EXBRC}' ).equals("Y"))
	{
		product= "BRC"
		Code="BRC"
		Productcode = "PRD_UK_0018"
		strBldS = func_AddProduct(Productcode,product,Code)
		Strbld.append(strBldS)
	}
}


log.info(Strbld)
testRunner.testCase.setPropertyValue("RNL_Trans_MTA1_CurrentPolicyPrice_XML", Strbld.toString())

def func_AddProduct(Productcode,product,Code)
{
	
	log.info(Productcode)
	log.info(product)
	def paymenttype = context.expand( '${658All#Payment type}' )
	log.info(paymenttype)
	StringBuilder strBldN = new StringBuilder()
	//def flag = context.expand( '${658All#NB/RNL}' )
	def flag = "REN"

	
		log.info "Renewal Block"
		strBldN.append("<gen:Product>")
		strBldN.append("<prod:ProductCode>"+Productcode+"</prod:ProductCode>")
		strBldN.append("<prod:ProductPriceName>"+product+"</prod:ProductPriceName>")
		strBldN.append("<gen:PriceList>")
		strBldN.append("<prod:PolicyPrice>")
		strBldN.append("<prod:PriceElementType/>")
		strBldN.append("<prod:PriceBreakdown>")
     	strBldN.append("<prod:CorePrice>")
		strBldN.append("<prod:NetRate>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:NetRate[1]}' )+"</prod:NetRate>")
		strBldN.append("<prod:NetRateTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:NetRateTax[1]}' )+"</prod:NetRateTax>")
		strBldN.append("<prod:Commission>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:Commission[1]}' )+"</prod:Commission>")
		strBldN.append("<prod:CommissionTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:CommissionTax[1]}' )+"</prod:CommissionTax>")
   		strBldN.append("<prod:InternallyFundedDiscount>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:InternallyFundedDiscount[1]}' )+"</prod:InternallyFundedDiscount>")
 		strBldN.append("<prod:TaxPercentage>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:TaxPercentage[1]}' )+"</prod:TaxPercentage>")
 		strBldN.append("<prod:TaxTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:TaxTotal[1]}' )+"</prod:TaxTotal>")
 		strBldN.append("<prod:Total>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:Total[1]}' )+"</prod:Total>")
 		strBldN.append("</prod:CorePrice>")
 		
    	 	strBldN.append("<prod:ArrangementFee>")
		strBldN.append("<prod:Fee>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:ArrangementFee[1]/tns6:Fee[1]}' )+"</prod:Fee>")
		strBldN.append("<prod:FeeTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:ArrangementFee[1]/tns6:FeeTax[1]}' )+"</prod:FeeTax>")
 		strBldN.append("<prod:InternallyFundedDiscount>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:ArrangementFee[1]/tns6:InternallyFundedDiscount[1]}' )+"</prod:InternallyFundedDiscount>")
 		strBldN.append("<prod:TaxPercentage>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:ArrangementFee[1]/tns6:TaxPercentage[1]}' )+"</prod:TaxPercentage>")
  		strBldN.append("<prod:Total>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:ArrangementFee[1]/tns6:Total[1]}' )+"</prod:Total>")
     	strBldN.append("</prod:ArrangementFee>")
       
		def Offernode = context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:Code[1]}' )
		log.info "Offernode-->"+Offernode
		//if((context.expand( '${658All#NB/RNL Offer}' )!= "") && (Offernode!=""))
		def persistentOffer = context.expand( '${658All#Persistent Offer}' )
		if((persistentOffer!= "") && (Offernode!=""))
   	  	{
    			strBldN.append("<prod:OfferCodeDiscountList>")
          	strBldN.append("<prod:OfferCodeDiscount>")
          	strBldN.append("<prod:Code>"+context.expand( '${658All#Persistent Offer}' )+"</prod:Code>")
          	strBldN.append("<prod:DiscountApplicationApproach>Product</prod:DiscountApplicationApproach>")
			strBldN.append("<prod:NetRate>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:NetRate[1]}' )+"</prod:NetRate>")
          	strBldN.append("<prod:NetRateTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:NetRateTax[1]}' )+"</prod:NetRateTax>")
          	strBldN.append("<prod:Commission>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:Commission[1]}' )+"</prod:Commission>")
         		strBldN.append("<prod:CommissionTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:CommissionTax[1]}' )+"</prod:CommissionTax>")
          	strBldN.append("<prod:ArrangementFee>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:ArrangementFee[1]}' )+"</prod:ArrangementFee>")
          	strBldN.append("<prod:ArrangementFeeTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:ArrangementFeeTax[1]}' )+"</prod:ArrangementFeeTax>")
          	strBldN.append("<prod:InternallyFundedDiscount>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:InternallyFundedDiscount[1]}' )+"</prod:InternallyFundedDiscount>")
         	 	strBldN.append("<prod:TaxPercentage>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:TaxPercentage[1]}' )+"</prod:TaxPercentage>")
          	strBldN.append("<prod:Total>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:Total[1]}' )+"</prod:Total>")
          	strBldN.append("</prod:OfferCodeDiscount>")
          	strBldN.append("</prod:OfferCodeDiscountList>")
		}
		if (context.expand( '${658All#RNL AD}')=="")
		{
			log.info "No AD"
		}
		
		else
		{
		int AD_Count = Integer.parseInt(context.expand( '${658All#RNL AD}' ))
		if(AD_Count !="") 
		{
			def ADNode = context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]}' )
	 	
	 		if (ADNode!="")
			{
				strBldN.append("<prod:AgentDiscountList>")
				for (int i=1; i<=AD_Count; i++)
				{
					strBldN.append("<prod:AgentDiscount>")
					strBldN.append("<prod:Code>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:Code[1]}' )+"</prod:Code>")
               		strBldN.append("<prod:DiscountApplicationApproach>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:DiscountApplicationApproach[1]}' )+"</prod:DiscountApplicationApproach>")
              			 strBldN.append("<prod:NetRate>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:NetRate[1]}' )+"</prod:NetRate>")
              			 strBldN.append("<prod:NetRateTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:NetRateTax[1]}' )+"</prod:NetRateTax>")
              	 		strBldN.append("<prod:Commission>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:Commission[1]}' )+"</prod:Commission>")
               		strBldN.append("<prod:CommissionTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:CommissionTax[1]}' )+"</prod:CommissionTax>")
               		strBldN.append("<prod:ArrangementFee>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:ArrangementFee[1]}' )+"</prod:ArrangementFee>")
               		strBldN.append("<prod:ArrangementFeeTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:ArrangementFeeTax[1]}' )+"</prod:ArrangementFeeTax>")
              		 	strBldN.append("<prod:InternallyFundedDiscount>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:InternallyFundedDiscount[1]}' )+"</prod:InternallyFundedDiscount>")
               		strBldN.append("<prod:TaxPercentage>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:TaxPercentage[1]}' )+"</prod:TaxPercentage>")
               		strBldN.append("<prod:Total>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:Total[1]}' )+"</prod:Total>")
               		strBldN.append("</prod:AgentDiscount>")
              	 	}
				strBldN.append("</prod:AgentDiscountList>")
			}
		}}
		strBldN.append("<prod:AccountingTotals>")
		strBldN.append("<prod:CoreDiscountsTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:CoreDiscountsTotal[1]}' )+"</prod:CoreDiscountsTotal>")
		strBldN.append("<prod:CoreDiscountsTaxTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:CoreDiscountsTaxTotal[1]}' )+"</prod:CoreDiscountsTaxTotal>")
		strBldN.append("<prod:CoreCommissionDiscountsTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:CoreCommissionDiscountsTotal[1]}' )+"</prod:CoreCommissionDiscountsTotal>")
		strBldN.append("<prod:CoreNetRateDiscountsTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:CoreNetRateDiscountsTotal[1]}' )+"</prod:CoreNetRateDiscountsTotal>")
		strBldN.append("<prod:ArrangementFeeGrandDiscountsTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:ArrangementFeeGrandDiscountsTotal[1]}' )+"</prod:ArrangementFeeGrandDiscountsTotal>")
		strBldN.append("<prod:ArrangementFeeTaxDiscountsTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:ArrangementFeeTaxDiscountsTotal[1]}' )+"</prod:ArrangementFeeTaxDiscountsTotal>")
		strBldN.append("<prod:ArrangementFeeDiscountsTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:ArrangementFeeDiscountsTotal[1]}' )+"</prod:ArrangementFeeDiscountsTotal>")
		strBldN.append("</prod:AccountingTotals>")
		strBldN.append("</prod:PriceBreakdown>")

		strBldN.append("<prod:TaxType>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:TaxType[1]}' )+"</prod:TaxType>")
		strBldN.append("<prod:TaxDate>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:TaxDate[1]}' )+"</prod:TaxDate>")
		strBldN.append("<prod:DateInceptedOnPolicy>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:DateInceptedOnPolicy[1]}' )+"</prod:DateInceptedOnPolicy>")
    		strBldN.append("<prod:RelativityPriceFactor>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:RelativityPriceFactor[1]}' )+"</prod:RelativityPriceFactor>")
     	strBldN.append("<prod:ExtrapolationFactor>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:ExtrapolationFactor[1]}' )+"</prod:ExtrapolationFactor>")
      	strBldN.append("<prod:ArrangementFeeTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:ArrangementFeeTotal[1]}' )+"</prod:ArrangementFeeTotal>")
  		strBldN.append("<prod:TotalLessArrangementFeeTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:TotalLessArrangementFeeTotal[1]}' )+"</prod:TotalLessArrangementFeeTotal>")
     	strBldN.append("<prod:TotalLessDiscounts>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:TotalLessDiscounts[1]}' )+"</prod:TotalLessDiscounts>")
     	strBldN.append("<prod:Total>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:Total[1]}' )+"</prod:Total>")
		strBldN.append("</prod:PolicyPrice>")
		strBldN.append("</gen:PriceList>")
		strBldN.append("<prod:InsideCoolingOffFlag>"+context.expand( '${658All#COOLINGOFF FLAG_'+Code+'}' )+"</prod:InsideCoolingOffFlag>")
		strBldN.append("<prod:FullRefundFlag>false</prod:FullRefundFlag>")
		strBldN.append("<prod:PaidPeriods>"+context.expand( '${658All#PaidPeriod_'+Code+'}' )+"</prod:PaidPeriods>")

		strBldN.append("</gen:Product>")
	return (strBldN)

}]]></script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Setup_658_TransPolicyPrice" id="800a7b2e-c5ac-4f21-963f-134cd47f1625">
    <con:settings/>
    <con:config>
      <script><![CDATA[def productType = context.expand( '${658All#ExProduct}' )
def cover = context.expand( '${658All#ExCover_type}' )
def id = context.expand( '${658All#ID}' )
log.info id
String delimiters = "\\,|\\&";
String[] prodArr = productType.split(delimiters);
StringBuilder Strbld = new StringBuilder()

if(prodArr.length > 0)
{	
	for (prod in prodArr)
	
	{
			if(prod.trim().equals("Roadside"))
		{
			product="Roadside"
			if(cover.equals("V1"))
			{
				Productcode = "PRD_UK_0002"
			}
			else
			{
				Productcode = "PRD_UK_0001"
			}
			strBldS = func_AddProduct(Productcode,product)
			Strbld.append(strBldS)
		}
		if(prod.trim().equals("HomeStart")||prod.trim().equals("Home Start"))
		{
			product= "HomeStart"
			Productcode = "PRD_UK_0003"
			strBldS = func_AddProduct(Productcode,product)
			Strbld.append(strBldS)
		}
		if(prod.trim().equals("Relay"))
		{
			product= "Relay"
			Productcode = "PRD_UK_0004"
			strBldS = func_AddProduct(Productcode,product)
			Strbld.append(strBldS)
		}
		if(prod.trim().equals("StayMobile")||prod.trim().equals("Stay Mobile"))
		{
			product= "StayMobile"
			Productcode = "PRD_UK_0005"
			strBldS = func_AddProduct(Productcode,product)
			Strbld.append(strBldS)
		}
		if(prod.trim().equals("Basic Breakdown Cover"))
		{
			product= "BasicBreakdown"
			Productcode = "PRD_UK_0020"
			strBldS = func_AddProduct(Productcode,product)
			Strbld.append(strBldS)
		}
		if(prod.trim().equals("ROCO"))
		{
			product= "ROCO"
			Productcode = "PRD_UK_0021"
			strBldS = func_AddProduct(Productcode,product)
			Strbld.append(strBldS)
		}
		if(prod.trim().equals("ROPOV"))
		{
			product= "ROPOV"
			Productcode = "PRD_UK_0023"
			strBldS = func_AddProduct(Productcode,product)
			Strbld.append(strBldS)
		}
		if(prod.trim().equals("Local Driver"))
		{
			product= "LocalDriver"
			Productcode = "PRD_UK_0022"
			strBldS = func_AddProduct(Productcode,product)
			Strbld.append(strBldS)
		}
		if(prod.trim().equals("Start Up"))
		{
			product= "StartUp"
			Productcode = "PRD_UK_0024"
			strBldS = func_AddProduct(Productcode,product)
			Strbld.append(strBldS)
		}
		if(prod.trim().equals("Standby"))
		{
			product= "Standby"
			Productcode = "PRD_UK_0030"
			strBldS = func_AddProduct(Productcode,product)
			Strbld.append(strBldS)
		}
	}
	if(context.expand( '${658All#EXBRC}' ).equals("Y"))
	{
		product= "BRC"
		Productcode = "PRD_UK_0018"
		strBldS = func_AddProduct(Productcode,product)
		Strbld.append(strBldS)
	}
}

log.info(Strbld)
testRunner.testCase.setPropertyValue("RNL_Trans_MTA1_TransPrice_XML", Strbld.toString())

def func_AddProduct(Productcode,product)
{
	log.info(Productcode)
	log.info(product)
	def paymenttype = context.expand( '${658All#Payment type}' )
	log.info(paymenttype)
	StringBuilder strBldN = new StringBuilder()
	//def flag = context.expand( '${658All#NB/RNL}' )
	def flag = "REN"
	log. info flag
	
		strBldN.append("<gen:TransactionProduct>")
		strBldN.append("<prod:ProductCode>"+Productcode+"</prod:ProductCode>")
		strBldN.append("<prod:ProductPriceName>"+product+"</prod:ProductPriceName>")
		strBldN.append("<gen:TransactionPriceList>")
		strBldN.append("<prod:Price>")
		strBldN.append("<prod:PriceElementType/>")
		strBldN.append("<prod:PriceBreakdown>")
     	strBldN.append("<prod:CorePrice>")
		strBldN.append("<prod:NetRate>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:NetRate[1]}' )+"</prod:NetRate>")
		strBldN.append("<prod:NetRateTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:NetRateTax[1]}' )+"</prod:NetRateTax>")
		strBldN.append("<prod:Commission>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:Commission[1]}' )+"</prod:Commission>")
		strBldN.append("<prod:CommissionTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:CommissionTax[1]}' )+"</prod:CommissionTax>")
   		strBldN.append("<prod:InternallyFundedDiscount>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:InternallyFundedDiscount[1]}' )+"</prod:InternallyFundedDiscount>")
 		strBldN.append("<prod:TaxPercentage>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:TaxPercentage[1]}' )+"</prod:TaxPercentage>")
 		strBldN.append("<prod:TaxTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:TaxTotal[1]}' )+"</prod:TaxTotal>")
 		strBldN.append("<prod:Total>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:CorePrice[1]/tns6:Total[1]}' )+"</prod:Total>")
 		strBldN.append("</prod:CorePrice>")
 		
    	 	strBldN.append("<prod:ArrangementFee>")
		strBldN.append("<prod:Fee>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:ArrangementFee[1]/tns6:Fee[1]}' )+"</prod:Fee>")
		strBldN.append("<prod:FeeTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:ArrangementFee[1]/tns6:FeeTax[1]}' )+"</prod:FeeTax>")
 		strBldN.append("<prod:InternallyFundedDiscount>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:ArrangementFee[1]/tns6:InternallyFundedDiscount[1]}' )+"</prod:InternallyFundedDiscount>")
 		strBldN.append("<prod:TaxPercentage>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:ArrangementFee[1]/tns6:TaxPercentage[1]}' )+"</prod:TaxPercentage>")
  		strBldN.append("<prod:Total>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:ArrangementFee[1]/tns6:Total[1]}' )+"</prod:Total>")
     	strBldN.append("</prod:ArrangementFee>")
       
		def Offernode = context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:Code[1]}' )
		
		//if((context.expand( '${658All#Persistent Offer}' )!= "") && (Offernode!=""))
		def persistentOffer = context.expand( '${658All#Persistent Offer}' )
		if((persistentOffer!= "") && (Offernode!=""))
   	  	{
    			strBldN.append("<prod:OfferCodeDiscountList>")
          	strBldN.append("<prod:OfferCodeDiscount>")
          	strBldN.append("<prod:Code>"+context.expand( '${658All#Persistent Offer}' )+"</prod:Code>")
          	strBldN.append("<prod:DiscountApplicationApproach>Product</prod:DiscountApplicationApproach>")
			strBldN.append("<prod:NetRate>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:NetRate[1]}' )+"</prod:NetRate>")
          	strBldN.append("<prod:NetRateTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:NetRateTax[1]}' )+"</prod:NetRateTax>")
          	strBldN.append("<prod:Commission>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:Commission[1]}' )+"</prod:Commission>")
         		strBldN.append("<prod:CommissionTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:CommissionTax[1]}' )+"</prod:CommissionTax>")
          	strBldN.append("<prod:ArrangementFee>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:ArrangementFee[1]}' )+"</prod:ArrangementFee>")
          	strBldN.append("<prod:ArrangementFeeTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:ArrangementFeeTax[1]}' )+"</prod:ArrangementFeeTax>")
          	strBldN.append("<prod:InternallyFundedDiscount>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:InternallyFundedDiscount[1]}' )+"</prod:InternallyFundedDiscount>")
         	 	strBldN.append("<prod:TaxPercentage>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:TaxPercentage[1]}' )+"</prod:TaxPercentage>")
          	strBldN.append("<prod:Total>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:OfferCodeDiscountList[1]/tns6:OfferCodeDiscount[tns6:Code ="'+context.expand( '${658All#Persistent Offer}' )+'"]/tns6:Total[1]}' )+"</prod:Total>")
          	strBldN.append("</prod:OfferCodeDiscount>")
          	strBldN.append("</prod:OfferCodeDiscountList>")
		}
		if (context.expand( '${658All#RNL AD}')=="")
		{
			log.info "No AD"
		}
		
		else
		{
		int AD_Count = Integer.parseInt(context.expand( '${658All#RNL AD}' ))
		if(AD_Count !="") 
		{
			def ADNode = context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]}' )
	 	
	 		if (ADNode!="")
			{
				strBldN.append("<prod:AgentDiscountList>")
				for (int i=1; i<=AD_Count; i++)
				{
					strBldN.append("<prod:AgentDiscount>")
					strBldN.append("<prod:Code>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:Code[1]}' )+"</prod:Code>")
               		strBldN.append("<prod:DiscountApplicationApproach>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:DiscountApplicationApproach[1]}' )+"</prod:DiscountApplicationApproach>")
              			 strBldN.append("<prod:NetRate>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:NetRate[1]}' )+"</prod:NetRate>")
              			 strBldN.append("<prod:NetRateTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:NetRateTax[1]}' )+"</prod:NetRateTax>")
              	 		strBldN.append("<prod:Commission>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:Commission[1]}' )+"</prod:Commission>")
               		strBldN.append("<prod:CommissionTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:CommissionTax[1]}' )+"</prod:CommissionTax>")
               		strBldN.append("<prod:ArrangementFee>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:ArrangementFee[1]}' )+"</prod:ArrangementFee>")
               		strBldN.append("<prod:ArrangementFeeTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:ArrangementFeeTax[1]}' )+"</prod:ArrangementFeeTax>")
              		 	strBldN.append("<prod:InternallyFundedDiscount>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:InternallyFundedDiscount[1]}' )+"</prod:InternallyFundedDiscount>")
               		strBldN.append("<prod:TaxPercentage>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:TaxPercentage[1]}' )+"</prod:TaxPercentage>")
               		strBldN.append("<prod:Total>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AgentDiscountList[1]/tns6:AgentDiscount['+ i +']/tns6:Total[1]}' )+"</prod:Total>")
               		strBldN.append("</prod:AgentDiscount>")
              	 	}
				strBldN.append("</prod:AgentDiscountList>")
			}
		}}
		//system discount for reprice threshold
		def PriceUpheld = context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; //tns8:GenerateQuoteResponse[1]/tns8:RepriceDetailsResponse[1]/tns8:OriginalPriceUpheld[1]}' )
		if (PriceUpheld == "true")
		{
			strBldN.append("<prod:SystemDiscountList>")
         		strBldN.append("<prod:SystemDiscount>")
        	  	strBldN.append("<prod:Code>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:SystemDiscountList[1]/tns6:SystemDiscount[tns6:Code="Waive_C"]/tns6:Code[1]}' )+"</prod:Code>")
          	strBldN.append("<prod:SystemDiscountCategory>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:SystemDiscountList[1]/tns6:SystemDiscount[tns6:Code="Waive_C"]/tns6:SystemDiscountCategory[1]}' )+"</prod:SystemDiscountCategory>")
         		strBldN.append("<prod:DiscountApplicationApproach>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:SystemDiscountList[1]/tns6:SystemDiscount[tns6:Code="Waive_C"]/tns6:DiscountApplicationApproach[1]}' )+"</prod:DiscountApplicationApproach>")
          	strBldN.append("<prod:NetRate>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:SystemDiscountList[1]/tns6:SystemDiscount[tns6:Code="Waive_C"]/tns6:NetRate[1]}' )+"</prod:NetRate>")
          	strBldN.append("<prod:NetRateTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:SystemDiscountList[1]/tns6:SystemDiscount[tns6:Code="Waive_C"]/tns6:NetRateTax[1]}' )+"</prod:NetRateTax>")
          	strBldN.append("<prod:Commission>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:SystemDiscountList[1]/tns6:SystemDiscount[tns6:Code="Waive_C"]/tns6:Commission[1]}' )+"</prod:Commission>")
          	strBldN.append("<prod:CommissionTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:SystemDiscountList[1]/tns6:SystemDiscount[tns6:Code="Waive_C"]/tns6:CommissionTax[1]}' )+"</prod:CommissionTax>")
          	strBldN.append("<prod:ArrangementFee>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:SystemDiscountList[1]/tns6:SystemDiscount[tns6:Code="Waive_C"]/tns6:ArrangementFee[1]}' )+"</prod:ArrangementFee>")
          	strBldN.append("<prod:ArrangementFeeTax>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:SystemDiscountList[1]/tns6:SystemDiscount[tns6:Code="Waive_C"]/tns6:ArrangementFeeTax[1]}' )+"</prod:ArrangementFeeTax>")
          	strBldN.append("<prod:InternallyFundedDiscount>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:SystemDiscountList[1]/tns6:SystemDiscount[tns6:Code="Waive_C"]/tns6:InternallyFundedDiscount[1]}' )+"</prod:InternallyFundedDiscount>")
         	 	strBldN.append("<prod:TaxPercentage>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:SystemDiscountList[1]/tns6:SystemDiscount[tns6:Code="Waive_C"]/tns6:TaxPercentage[1]}' )+"</prod:TaxPercentage>")
         	 	strBldN.append("<prod:Total>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:SystemDiscountList[1]/tns6:SystemDiscount[tns6:Code="Waive_C"]/tns6:Total[1]}' )+"</prod:Total>")
          	strBldN.append("</prod:SystemDiscount>")
          	strBldN.append("</prod:SystemDiscountList>")
		}
		strBldN.append("<prod:AccountingTotals>")
		strBldN.append("<prod:CoreDiscountsTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:CoreDiscountsTotal[1]}' )+"</prod:CoreDiscountsTotal>")
		strBldN.append("<prod:CoreDiscountsTaxTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:CoreDiscountsTaxTotal[1]}' )+"</prod:CoreDiscountsTaxTotal>")
		strBldN.append("<prod:CoreCommissionDiscountsTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:CoreCommissionDiscountsTotal[1]}' )+"</prod:CoreCommissionDiscountsTotal>")
		strBldN.append("<prod:CoreNetRateDiscountsTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:CoreNetRateDiscountsTotal[1]}' )+"</prod:CoreNetRateDiscountsTotal>")
		strBldN.append("<prod:ArrangementFeeGrandDiscountsTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:ArrangementFeeGrandDiscountsTotal[1]}' )+"</prod:ArrangementFeeGrandDiscountsTotal>")
		strBldN.append("<prod:ArrangementFeeTaxDiscountsTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:ArrangementFeeTaxDiscountsTotal[1]}' )+"</prod:ArrangementFeeTaxDiscountsTotal>")
		strBldN.append("<prod:ArrangementFeeDiscountsTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:PriceBreakdown[1]/tns6:AccountingTotals[1]/tns6:ArrangementFeeDiscountsTotal[1]}' )+"</prod:ArrangementFeeDiscountsTotal>")
		strBldN.append("</prod:AccountingTotals>")
		strBldN.append("</prod:PriceBreakdown>")

		strBldN.append("<prod:TaxType>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:TaxType[1]}' )+"</prod:TaxType>")
		strBldN.append("<prod:TaxDate>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:TaxDate[1]}' )+"</prod:TaxDate>")
		strBldN.append("<prod:DateInceptedOnPolicy>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:DateInceptedOnPolicy[1]}' )+"</prod:DateInceptedOnPolicy>")
    		strBldN.append("<prod:RelativityPriceFactor>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:RelativityPriceFactor[1]}' )+"</prod:RelativityPriceFactor>")
     	strBldN.append("<prod:ExtrapolationFactor>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:ExtrapolationFactor[1]}' )+"</prod:ExtrapolationFactor>")
      	strBldN.append("<prod:ArrangementFeeTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:ArrangementFeeTotal[1]}' )+"</prod:ArrangementFeeTotal>")
  		strBldN.append("<prod:TotalLessArrangementFeeTotal>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:TotalLessArrangementFeeTotal[1]}' )+"</prod:TotalLessArrangementFeeTotal>")
     	strBldN.append("<prod:TotalLessDiscounts>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:TotalLessDiscounts[1]}' )+"</prod:TotalLessDiscounts>")
     	strBldN.append("<prod:Total>"+context.expand( '${RenewalE2E#Response#declare namespace tns8=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_RNL_3\'; declare namespace tns6=\'http://www.theaa.com/CommonServices/Data/Product.2\'; //tns8:GenerateQuoteResponse[1]/tns8:ProductList[1]/tns6:Payment[1]/tns6:Product[tns6:ProductCode="'+Productcode+'"]/tns6:PriceList[1]/tns6:Price[1]/tns6:Total[1]}' )+"</prod:Total>")
		strBldN.append("</prod:Price>")
		strBldN.append("</gen:TransactionPriceList>")
		if (product =="BRC")
		{
			strBldN.append("<prod:VehicleAgeList>")
			strBldN.append("<prod:VehicleAge>"+context.expand( '${658All#EXCar1}' )+"</prod:VehicleAge>")
		
			if (context.expand( '${658All#EXCar2}' ) != "")
			{
				strBldN.append("<prod:VehicleAge>"+context.expand( '${658All#EXCar2}' )+"</prod:VehicleAge>")
			}
			if (context.expand( '${658All#EXCar3}' ) != "")
			{
				strBldN.append("<prod:VehicleAge>"+context.expand( '${658All#EXCar3}' )+"</prod:VehicleAge>")
			}
			if (context.expand( '${658All#EXCar4}' ) != "")
			{
				strBldN.append("<prod:VehicleAge>"+context.expand( '${658All#EXCar4}' )+"</prod:VehicleAge>")
			}
           	strBldN.append("</prod:VehicleAgeList>")
		}
		strBldN.append("</gen:TransactionProduct>")
		
		return (strBldN)

}]]></script>
    </con:config>
  </con:testStep>
  <con:testStep type="request" id="e1ca216d-22f5-44d2-b66e-437b7ab09ff0" name="658Request">
    <con:settings/>
    <con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
      <con:interface>SOAPServiceBindingMTA</con:interface>
      <con:operation>GenerateQuote</con:operation>
      <con:request name="658Request" outgoingWss="" incomingWss="" timeout="" sslKeystore="" useWsAddressing="false" useWsReliableMessaging="false" wssPasswordType="" id="b984e810-397e-41e6-898e-e77fcf7a3e2c">
        <con:settings>
          <con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting>
        </con:settings>
        <con:encoding>UTF-8</con:encoding>
        <con:endpoint>http://rh0124v:18027/SOAPServiceBinding/BSROS_GenerateQuote_MTA/</con:endpoint>
        <con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:gen="http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.3" xmlns:mes="http://www.theaa.com/CommonServices/Data/Message/MessageHeader.2" xmlns:com="http://www.theaa.com/CommonServices/Data/Common" xmlns:prod="http://www.theaa.com/CommonServices/Data/Product.2">
   <soapenv:Header/>
   <soapenv:Body>
      <gen:GenerateQuoteRequest xmlns="http://www.theaa.com/CommonServices/Data/Common" xmlns:ns5="http://www.theaa.com/CommonServices/Data/Common.2">
         <mes:RequestHeader>
            <mes:TransactionId>RO-MTA-1712-719</mes:TransactionId>
            <mes:Version>1.0</mes:Version>
            <mes:RequestDateTime>${#TestCase#RequestDateTime}</mes:RequestDateTime>
            <mes:Source>
               <mes:Domain>SALES</mes:Domain>
               <mes:Channel>SanityTesting</mes:Channel>
               <mes:LineOfBusiness>ROS</mes:LineOfBusiness>
               <mes:Name>Pricing Services</mes:Name>
               <mes:User>PS Testing</mes:User>
            </mes:Source>
         </mes:RequestHeader>
         <gen:IndicativePriceFlag>true</gen:IndicativePriceFlag>
         <prod:Currency>GBP</prod:Currency>
         <gen:TradeUp>false</gen:TradeUp>
         <gen:ManConYear1>false</gen:ManConYear1>
         <gen:MTAReason>Make a Change</gen:MTAReason>
         <gen:MTACode>ABC</gen:MTACode>
         <gen:FreeMonths>0</gen:FreeMonths>
         <gen:PaymentType>${658All#Payment type}</gen:PaymentType>
         <gen:NewProductList>
            <prod:EffectivePriceDateTime>${658All#MTA Date}T00:00:00</prod:EffectivePriceDateTime>
            <prod:PolicyStartDateTime>${658All#POLICYSTARTDATE}T00:00:00</prod:PolicyStartDateTime>
            <prod:PolicyEndDateTime>${658All#POLICYENDDATE}T00:00:00</prod:PolicyEndDateTime>
            <prod:OfferCodeDetailList>
               <prod:OfferCodeDetail>
                  <prod:OfferCode>${658All#Persistent Offer}</prod:OfferCode>
                  <prod:OfferCodeApplicationLevel>1</prod:OfferCodeApplicationLevel>
                  <prod:IsPersistent>true</prod:IsPersistent>
               </prod:OfferCodeDetail>
                  <prod:OfferCodeDetail>
                  <prod:OfferCode>${658All#MTA Offer}</prod:OfferCode>
                  <prod:OfferCodeApplicationLevel>1</prod:OfferCodeApplicationLevel>
                  <prod:IsPersistent>false</prod:IsPersistent>
               </prod:OfferCodeDetail>
            </prod:OfferCodeDetailList>
            <prod:SourceCode>Natural Search</prod:SourceCode>
            ${#TestCase#MTA1_New_ProductList_XML}
            <gen:CoveredPersons>${#TestCase#MTA1NEWCover}</gen:CoveredPersons>
            ${#TestCase#MTAAgentDiscount_XML}
            <!--<prod:MultiplyingFactor>${658All#Multiplying Factor}</prod:MultiplyingFactor>-->
         </gen:NewProductList>
         <gen:CustomerDetails>
            <gen:Postcode>RG21 7AS</gen:Postcode>
            <gen:MembershipStatus>
               <gen:IsMember>true</gen:IsMember>
               <gen:MembershipTenure>0</gen:MembershipTenure>
            </gen:MembershipStatus>
         </gen:CustomerDetails>
         ${#TestCase#MTAFeeList_XML}
         <gen:CurrentPolicyDetails>
            <prod:PaymentType>${658All#Payment type}</prod:PaymentType>
            <prod:PolicyStartDateTime>${658All#POLICYSTARTDATE}T00:00:00</prod:PolicyStartDateTime>
            <prod:PolicyEndDateTime>${658All#POLICYENDDATE}T00:00:00</prod:PolicyEndDateTime>
            <prod:CoveredPersons>${#TestCase#Cover}</prod:CoveredPersons>
            <prod:Currency>GBP</prod:Currency>
            ${#TestCase#RNL_Trans_MTA1_CurrentPolicyPrice_XML}
         </gen:CurrentPolicyDetails>
         <gen:TransactionRecordList>
            <gen:TransactionRecord>
               <gen:Transaction>${#TestCase#Transaction}</gen:Transaction>
               <gen:TransactionRequestDateTime>${658All#POLICYSTARTDATE}T00:00:00</gen:TransactionRequestDateTime>
               <gen:TransactionStartDateTime>${658All#POLICYSTARTDATE}T00:00:00</gen:TransactionStartDateTime>
               <gen:TransactionProductList>
                  <prod:PaymentType>${658All#Payment type}</prod:PaymentType>
                  <prod:CoveredPersons>${#TestCase#Cover}</prod:CoveredPersons>
                  <prod:Currency>GBP</prod:Currency>
                  ${#TestCase#RNL_Trans_MTA1_TransPrice_XML}
                  <prod:SurchargeFeeList>
                     <prod:SurchargeFee>
                        <prod:Code>Cancellation1</prod:Code>
                        <prod:SurchargeRequestType>A</prod:SurchargeRequestType>
                        <prod:IsWaived>false</prod:IsWaived>
                        <prod:TaxType>I</prod:TaxType>
                        <prod:Fee>17.86</prod:Fee>
                        <prod:FeeTax>2.14</prod:FeeTax>
                        <prod:TaxPercentage>0.12</prod:TaxPercentage>
                        <prod:Total>20.0</prod:Total>
                     </prod:SurchargeFee>
                     <prod:SurchargeFee>
                        <prod:Code>Cancellation2</prod:Code>
                        <prod:SurchargeRequestType>A</prod:SurchargeRequestType>
                        <prod:IsWaived>false</prod:IsWaived>
                        <prod:TaxType>I</prod:TaxType>
                        <prod:Fee>5.36</prod:Fee>
                        <prod:FeeTax>0.64</prod:FeeTax>
                        <prod:TaxPercentage>0.12</prod:TaxPercentage>
                        <prod:Total>6.0</prod:Total>
                     </prod:SurchargeFee>
                     <prod:SurchargeFee>
                        <prod:Code>WillJoinCanx</prod:Code>
                        <prod:SurchargeRequestType>A</prod:SurchargeRequestType>
                        <prod:IsWaived>false</prod:IsWaived>
                        <prod:TaxType>V</prod:TaxType>
                        <prod:Fee>82.5</prod:Fee>
                        <prod:FeeTax>16.5</prod:FeeTax>
                        <prod:TaxPercentage>0.2</prod:TaxPercentage>
                        <prod:Total>99.0</prod:Total>
                     </prod:SurchargeFee>
                  </prod:SurchargeFeeList>
               </gen:TransactionProductList>
            </gen:TransactionRecord>
         </gen:TransactionRecordList>
      </gen:GenerateQuoteRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request>
        <con:credentials>
          <con:selectedAuthProfile>No Authorization</con:selectedAuthProfile>
          <con:authType>No Authorization</con:authType>
        </con:credentials>
        <con:jmsConfig JMSDeliveryMode="PERSISTENT"/>
        <con:jmsPropertyConfig/>
        <con:wsaConfig mustUnderstand="NONE" version="200508" action="GenerateQuote"/>
        <con:wsrmConfig version="1.2"/>
      </con:request>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Save xml" id="d6518124-e0a1-4e86-b665-8ae1490245ad" disabled="true">
    <con:settings/>
    <con:config>
      <script>now=new java.text.SimpleDateFormat("yyyyMMdd'T'HHmmss").format(new Date())
//Save response

def directory = "N:/Systems_development/RIO/Road MTA-CR-242/Soap UI/Test Results/408NBR/XML"
def scenarioNo = context.expand( '${658All#ID}' )
def requestFile = new File(directory, "${scenarioNo}_request"+ now +".xml")
requestFile.append( context.expand('${658Request#Request}') )
//def responseFile = new File(directory, "${scenarioNo}_response"+ now +".xml")
//responseFile.append( context.expand('${658Request#Response}') )</script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Validate" id="af06f9a2-dc96-4b32-9e9e-547a6b179e43">
    <con:settings/>
    <con:config>
      <script>import java.text.DecimalFormat;
int numOfIterations = Integer.parseInt(context.expand( '${#TestCase#NumOfIterations}' ))
numOfIterations++
testRunner.testCase.setPropertyValue("NumOfIterations", new Integer(numOfIterations).toString())
def id = context.expand( '${658All#ID}' )
def payment = context.expand( '${658All#Payment type}' )
log.info id


// Check what Products to validate for transaction price
def ExproductType = context.expand( '${408RoadAll#EXPRODUCT}' )
def NewproductType = context.expand( '${658All#NEWPRODUCT}' )
def newString = ExproductType + ","+NewproductType
def productType = context.expand( '${658All#NEWPRODUCT}' )
String delimiters = "\\,|\\&amp;";
String[] prodArr = newString.split(delimiters);
StringBuilder strBld = new StringBuilder();
def roadcount = 1
def hscount = 1
def recount = 1
def smcount = 1

//validate individual product
if(prodArr.length > 0)
{

	for (prod in prodArr)
	{
		
		if(prod.trim().equals("Roadside"))
		{
			product= "Roadside"
			if (roadcount.equals(2) )
			{
				log.info ("not doing it again road")
			}
			else
			{
				func_Check(productType,product,"RO",payment,id)
				roadcount++
			}
		}
		if(prod.trim().equals("Home Start"))
		{
			product= "HomeStart"
			if (hscount.equals(2) )
			{
				log.info ("not doing it again")
			}
			else
			{
				func_Check(productType,product,"HS",payment,id)
				hscount++
			}
		}
		if(prod.trim().equals("Relay"))
		{
			product= "Relay"
			if (recount.equals(2) )
			{
				log.info ("not doing it again")
			}
			else
			{
				func_Check(productType,product,"RE",payment,id)
				recount++
			}
		}
		if(prod.trim().equals("Stay Mobile"))
		{
			product= "StayMobile"
			if (smcount.equals(2) )
			{
				log.info ("not doing it again")
			}
			else
			{
				smcount++
				func_Check(productType,product,"SM",payment,id)
			}
		}	
	}
}




//Transaction Price Breakdown
def GrandTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:Total[1]}' )
def GrandTotalExcDisc = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalExcludingDiscounts[1]}' )
def DiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:DiscountTotal[1]}' )
def BaseCoverTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:BaseCoverTotal[1]}' )
def BaseCoverTotalLessDisc = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:BaseCoverTotalLessDiscounts[1]}' )
def BaseCoverAAFTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:BaseCoverArrangementFeeTotal[1]}' )
def TotalAAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalArrangementFee[1]}' )
def FeeTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:SurchargeFeeTotal[1]}' )
def TotalLessTotalAAFAddons = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalLessTotalAAFAndTotalAddons[1]}' )
def TotalLessFees = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalLessSurchargeFees[1]}' )
def TotalLessAAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalLessArrangementFees[1]}' )
def TotalIPT = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalIPT[1]}' )
def TotalVAT = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalVAT[1]}' )
def TransSubType = context.expand( '${658Request#Response#declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:TransactionSubType[1]}' )
		//Calculate New Business Discount percentage
		Float Total1 = Float.parseFloat(context.expand( '${NB Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_NB.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[tns1:PaymentType="'+payment+'"]/tns1:TotalPriceBreakdown[1]/tns1:TotalExcludingDiscounts[1]}' ))
		Float Discount1 = Float.parseFloat(context.expand( '${NB Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_NB.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[tns1:PaymentType="'+payment+'"]/tns1:TotalPriceBreakdown[1]/tns1:DiscountTotal[1]}' ))
		Float DiscountPercentage = Discount1/Total1
		log.info(Total1 +","+ Discount1)
		func_write(payment,"AgentDisc,ADPercentage","",DiscountPercentage)

	func_write(payment,"TotalPriceBreakdown,CombinedTotal","",GrandTotal)
	func_write(payment,"TotalPriceBreakdown,TotalLessDisc","",GrandTotalExcDisc)
	func_write(payment,"TotalPriceBreakdown,DiscountsTotal","",DiscTotal)
	func_write(payment,"TotalPriceBreakdown,BaseCoverTotal","",BaseCoverTotal)
	func_write(payment,"TotalPriceBreakdown,BaseCoverLessDisc","",BaseCoverTotalLessDisc)
	func_write(payment,"TotalPriceBreakdown,BaseCoverAAFTotal","",BaseCoverAAFTotal)
	func_write(payment,"TotalPriceBreakdown,TotalAAF","",TotalAAF)
	func_write(payment,"TotalPriceBreakdown,TotalFee","",FeeTotal)
	func_write(payment,"TotalPriceBreakdown,TotalLessAAFLessAddons","",TotalLessTotalAAFAddons)
	func_write(payment,"TotalPriceBreakdown,TotalLessFee","",TotalLessFees)
	func_write(payment,"TotalPriceBreakdown,TotalLessAAF","",TotalLessAAF)
	func_write(payment,"TotalPriceBreakdown,TotalVAT","",TotalVAT)
	func_write(payment,"TotalPriceBreakdown,TotalIPT","",TotalIPT)
	func_write(payment,"TotalPriceBreakdown,TransSubType","",TransSubType)



 //Policy Price Breakdown
def P_GrandTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:Total[1]}' )
def P_GrandTotalExcDisc = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:TotalExcludingDiscounts[1]}' )
def P_DiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:DiscountTotal[1]}' )
def P_BaseCoverTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:BaseCoverTotal[1]}' )
def P_BaseCoverTotalLessDisc = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:BaseCoverTotalLessDiscounts[1]}' )
def P_BaseCoverAAFTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:BaseCoverArrangementFeeTotal[1]}' )
def P_TotalAAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:TotalArrangementFee[1]}' )
def P_FeeTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:SurchargeFeeTotal[1]}' )
def P_TotalLessTotalAAFAddons = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:TotalLessTotalAAFAndTotalAddons[1]}' )
def P_TotalLessFees = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:TotalLessSurchargeFees[1]}' )
def P_TotalLessAAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:TotalLessArrangementFees[1]}' )
def P_TotalIPT = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:TotalIPT[1]}' )
func_write(payment,"Policy,CombinedTotal","",P_GrandTotal)
	func_write(payment,"Policy,TotalLessDisc","",P_GrandTotalExcDisc)
	func_write(payment,"Policy,DiscountsTotal","",P_DiscTotal)
	func_write(payment,"Policy,BaseCoverTotal","",P_BaseCoverTotal)
	func_write(payment,"Policy,BaseCoverLessDisc","",P_BaseCoverTotalLessDisc)
	func_write(payment,"Policy,BaseCoverAAFTotal","",P_BaseCoverAAFTotal)
	func_write(payment,"Policy,TotalAAF","",P_TotalAAF)
	func_write(payment,"Policy,TotalFee","",P_FeeTotal)
	func_write(payment,"Policy,TotalLessAAFLessAddons","",P_TotalLessTotalAAFAddons)
	func_write(payment,"Policy,TotalLessFee","",P_TotalLessFees)
	func_write(payment,"Policy,TotalLessAAF","",P_TotalLessAAF)
	func_write(payment,"Policy,TotalIPT","",P_TotalIPT)


if(context.expand( '${658All#NEWBRC}' )=="Y" || context.expand( '${658All#EXBRC}' )=="Y")
{
	product= "BRC"
	func_Check(productType,product,"BRC",payment,id)
}		

def func_Check(productType,product,name,payment,id)
{
	log.info product
	log.info id
	//Transaction price
	def CoreNet = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:NetRate[1]}' )
	def CoreNetTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:NetRateTax[1]}' )
	def CoreComm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:Commission[1]}' )
	def CoreCommTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:CommissionTax[1]}' )
	def TaxTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:TaxTotal[1]}' )
	def CoreTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:Total[1]}' )
	def AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:ArrangementFee[1]/tns1:Fee[1]}' )
	def AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:ArrangementFee[1]/tns1:FeeTax[1]}' )
	def AAFTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:ArrangementFee[1]/tns1:Total[1]}' )
	def CoreDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreDiscountsTotal[1]}' )
	def CoreDiscTaxTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreDiscountsTaxTotal[1]}' )
	def CoreCommDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreCommissionDiscountsTotal[1]}' )
	def CoreNetDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreNetRateDiscountsTotal[1]}' )
	def AAFGrandDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:ArrangementFeeGrandDiscountsTotal[1]}' )
	def AAFTaxDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:ArrangementFeeTaxDiscountsTotal[1]}' )
	def AAFDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:ArrangementFeeDiscountsTotal[1]}' )
	def ProdRel = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:RelativityPriceFactor[1]}' )
	def ProdAAFTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:ArrangementFeeTotal[1]}' )
	def ProdTotalLessAAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:TotalLessArrangementFeeTotal[1]}' )
	def ProdTotalLessDisc = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:TotalLessDiscounts[1]}' )
	def ProdTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:Total[1]}' )

	func_write(payment,"CORE,Net",product,CoreNet)
	func_write(payment,"CORE,NetTax",product,CoreNetTax)
	func_write(payment,"CORE,Commission",product,CoreComm)
	func_write(payment,"CORE,CommissionTax",product,CoreCommTax)
	func_write(payment,"CORE,TaxTotal",product,TaxTotal)
	func_write(payment,"CORE,Total",product,CoreTotal)
	func_write(payment,"AAF,AAF",product,AAF)
	func_write(payment,"AAF,AAFTax",product,AAFTax)
	func_write(payment,"AAF,Total",product,AAFTotal)

	//Transaction Offer validation
	def OFFER = ""
	def OLDOFFER = context.expand( '${658All#NB/RNL Offer}' )
	def OfferNode = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OFFER+'"]/tns1:Code[1]}' )
	def Offernet3,OffernetTax3,Offercomm3,OffercommTax3,OfferAAF3,OfferAAFTax3,OfferIFD3,OfferTotal3
	
	if (OLDOFFER !="" &amp;&amp; OFFER != OLDOFFER) // if old offer needs to be clawed back
	{
		def OldOfferNode = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:Code[1]}' )
		if (OldOfferNode !="")
		{
			Offernet3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:NetRate[1]}' )
			OffernetTax3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:NetRateTax[1]}' )
			Offercomm3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:Commission[1]}' )
			OffercommTax3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:CommissionTax[1]}' )
			OfferAAF3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:ArrangementFee[1]}' )
			OfferAAFTax3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:ArrangementFeeTax[1]}' )
			OfferIFD3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:InternallyFundedDiscount[1]}' )
			OfferTotal3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:Total[1]}' )

			func_write(payment,"Offer3,Net",product,Offernet3)
			func_write(payment,"Offer3,NetTax",product,OffernetTax3)
			func_write(payment,"Offer3,Commission",product,Offercomm3)
			func_write(payment,"Offer3,CommissionTax",product,OffercommTax3)
			func_write(payment,"Offer3,AAF",product,OfferAAF3)
			func_write(payment,"Offer3,AAFTax",product,OfferAAFTax3)
			func_write(payment,"Offer3,IFD",product,OfferIFD3)
			func_write(payment,"Offer3,Total",product,OfferTotal3)
		}
	}

	//Transaction AD validation
	//def AD1 = context.expand( '${658All#MTA AD}' )
	def AD1Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Code[1]}' )
	def AD1net,AD1netTax,AD1comm,AD1commTax,AD1AAF,AD1AAFTax,AD1IFD,AD1Total,AD2net,AD2netTax,AD2comm,AD2commTax,AD2AAF,AD2AAFTax,AD2IFD,AD2Total
	
	if ( AD1Node != "") //if new AD1 exists and AD1 node present
	{
		AD1net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:NetRate[1]}' )
		AD1netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:NetRateTax[1]}' )
		AD1comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Commission[1]}' )
		AD1commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:CommissionTax[1]}' )
		AD1AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:ArrangementFee[1]}' )
		AD1AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:ArrangementFeeTax[1]}' )
		AD1IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:InternallyFundedDiscount[1]}' )
		AD1Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Total[1]}' )
	
		func_write(payment,"AgentDisc,AD1Net",product,AD1net)
		func_write(payment,"AgentDisc,AD1NetTax",product,AD1netTax)
		func_write(payment,"AgentDisc,AD1Commission",product,AD1comm)
		func_write(payment,"AgentDisc,AD1CommissionTax",product,AD1commTax)
		func_write(payment,"AgentDisc,AD1AAF",product,AD1AAF)
		func_write(payment,"AgentDisc,AD1AAFTax",product,AD1AAFTax)
		func_write(payment,"AgentDisc,AD1IFD",product,AD1IFD)
		func_write(payment,"AgentDisc,AD1Total",product,AD1Total)
	}


	def AD2Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns2=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns2:GenerateQuoteResponse[1]/tns2:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:Code[1]}' )
	if (AD2Node!="")
	{
		AD2net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns2=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns2:GenerateQuoteResponse[1]/tns2:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:NetRate[1]}' )
		AD2netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns2=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns2:GenerateQuoteResponse[1]/tns2:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:NetRateTax[1]}' )
		AD2comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns2=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns2:GenerateQuoteResponse[1]/tns2:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:Commission[1]}' )
		AD2commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns2=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns2:GenerateQuoteResponse[1]/tns2:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:CommissionTax[1]}' )
		AD2AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns2=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns2:GenerateQuoteResponse[1]/tns2:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:ArrangementFee[1]}' )
		AD2AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns2=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns2:GenerateQuoteResponse[1]/tns2:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:ArrangementFeeTax[1]}' )
		AD2IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns2=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns2:GenerateQuoteResponse[1]/tns2:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:InternallyFundedDiscount[1]}' )
		AD2Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns2=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns2:GenerateQuoteResponse[1]/tns2:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:Total[1]}' )

			func_write(payment,"AgentDisc,AD2Net",product,AD2net)
			func_write(payment,"AgentDisc,AD2NetTax",product,AD2netTax)
			func_write(payment,"AgentDisc,AD2Commission",product,AD2comm)
			func_write(payment,"AgentDisc,AD2CommissionTax",product,AD2commTax)
			func_write(payment,"AgentDisc,AD2AAF",product,AD2AAF)
			func_write(payment,"AgentDisc,AD2AAFTax",product,AD2AAFTax)
			func_write(payment,"AgentDisc,AD2IFD",product,AD2IFD)
			func_write(payment,"AgentDisc,AD2Total",product,AD2Total)		
	}
	

	def AD3net,AD3netTax,AD3comm,AD3commTax,AD3AAF,AD3AAFTax,AD3IFD,AD3Total
	def AD3Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:Code[1]}' )
		if (AD3Node!="")
		{
			AD3net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:NetRate[1]}' )
			AD3netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:NetRateTax[1]}' )
			AD3comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:Commission[1]}' )
			AD3commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:CommissionTax[1]}' )
			AD3AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:ArrangementFee[1]}' )
			AD3AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:ArrangementFeeTax[1]}' )
			AD3IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:InternallyFundedDiscount[1]}' )
			AD3Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:Total[1]}' )

			func_write(payment,"AgentDisc,AD3Net",product,AD3net)
			func_write(payment,"AgentDisc,AD3NetTax",product,AD3netTax)
			func_write(payment,"AgentDisc,AD3Commission",product,AD3comm)
			func_write(payment,"AgentDisc,AD3CommissionTax",product,AD3commTax)
			func_write(payment,"AgentDisc,AD3AAF",product,AD3AAF)
			func_write(payment,"AgentDisc,AD3AAFTax",product,AD3AAFTax)
			func_write(payment,"AgentDisc,AD3IFD",product,AD3IFD)
			func_write(payment,"AgentDisc,AD3Total",product,AD3Total)		
		}

		
	func_write(payment,"AccountingTotals,CoreDiscTotal",product,CoreDiscTotal)
	func_write(payment,"AccountingTotals,CoreDiscTaxTotal",product,CoreDiscTaxTotal)
	func_write(payment,"AccountingTotals,CoreCommDiscTotal",product,CoreCommDiscTotal)
	func_write(payment,"AccountingTotals,CoreNetDiscTotal",product,CoreNetDiscTotal)
	func_write(payment,"AccountingTotals,AAFGrandDiscTotal",product,AAFGrandDiscTotal)
	func_write(payment,"AccountingTotals,AAFTaxDiscTotal",product,AAFTaxDiscTotal)
	func_write(payment,"AccountingTotals,AAFDiscTotal",product,AAFDiscTotal)
	func_write(payment,"RelFactor",product,ProdRel)
	func_write(payment,"AAFTotal",product,ProdAAFTotal)
	func_write(payment,"TotalLessAAFTotal",product,ProdTotalLessAAF)
	func_write(payment,"TotalLessDisc",product,ProdTotalLessDisc)
	func_write(payment,"ProductTotal",product,ProdTotal)
	

	def Sysdisc1Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:Code[1]}' )
	log.info Sysdisc1Node
	def Sysdisc1net,Sysdisc1netTax,Sysdisc1comm,Sysdisc1commTax,Sysdisc1AAF,Sysdisc1AAFTax,Sysdisc1IFD,Sysdisc1Total
	if (Sysdisc1Node!="")
	{
		Sysdisc1net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:NetRate[1]}' )
		Sysdisc1netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:NetRateTax[1]}' )
		Sysdisc1comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:Commission[1]}' )
		Sysdisc1commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:CommissionTax[1]}' )
		Sysdisc1AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:ArrangementFee[1]}' )
		Sysdisc1AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:ArrangementFeeTax[1]}' )
		Sysdisc1IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:InternallyFundedDiscount[1]}' )
		Sysdisc1Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:Total[1]}' )
		func_write(payment,"SysDisc,Sysdisc1Net",product,Sysdisc1Net)
		func_write(payment,"SysDisc,Sysdisc1NetTax",product,Sysdisc1NetTax)
		func_write(payment,"SysDisc,Sysdisc1Commission",product,Sysdisc1Comm)
		func_write(payment,"SysDisc,Sysdisc1CommissionTax",product,Sysdisc1CommTax)
		func_write(payment,"SysDisc,Sysdisc1AAF",product,Sysdisc1AAF)
		func_write(payment,"SysDisc,Sysdisc1AAFTax",product,Sysdisc1AAFTax)
		func_write(payment,"SysDisc,Sysdisc1IFD",product,Sysdisc1IFD)
		func_write(payment,"SysDisc,Sysdisc1Total",product,Sysdisc1Total)
	}

	def Sysdisc2Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:Code[1]}' )
	log.info Sysdisc2Node
	def Sysdisc2net,Sysdisc2netTax,Sysdisc2comm,Sysdisc2commTax,Sysdisc2AAF,Sysdisc2AAFTax,Sysdisc2IFD,Sysdisc2Total
	if (Sysdisc2Node!="")
	{
		Sysdisc2net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:NetRate[1]}' )
		Sysdisc2netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:NetRateTax[1]}' )
		Sysdisc2comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:Commission[1]}' )
		Sysdisc2commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:CommissionTax[1]}' )
		Sysdisc2AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:ArrangementFee[1]}' )
		Sysdisc2AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:ArrangementFeeTax[1]}' )
		Sysdisc2IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:InternallyFundedDiscount[1]}' )
		Sysdisc2Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:Total[1]}' )
		func_write(payment,"SysDisc,Sysdisc2Net",product,Sysdisc2Net)
		func_write(payment,"SysDisc,Sysdisc2NetTax",product,Sysdisc2NetTax)
		func_write(payment,"SysDisc,Sysdisc2Commission",product,Sysdisc2Comm)
		func_write(payment,"SysDisc,Sysdisc2CommissionTax",product,Sysdisc2CommTax)
		func_write(payment,"SysDisc,Sysdisc2AAF",product,Sysdisc2AAF)
		func_write(payment,"SysDisc,Sysdisc2AAFTax",product,Sysdisc2AAFTax)
		func_write(payment,"SysDisc,Sysdisc2IFD",product,Sysdisc2IFD)
		func_write(payment,"SysDisc,Sysdisc2Total",product,Sysdisc2Total)
		
	}

	def Sysdisc3Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:Code[1]}' )
	log.info Sysdisc3Node
	def Sysdisc3net,Sysdisc3netTax,Sysdisc3comm,Sysdisc3commTax,Sysdisc3AAF,Sysdisc3AAFTax,Sysdisc3IFD,Sysdisc3Total
	if (Sysdisc3Node!="")
	{
		Sysdisc3net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:NetRate[1]}' )
		Sysdisc3netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:NetRateTax[1]}' )
		Sysdisc3comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:Commission[1]}' )
		Sysdisc3commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:CommissionTax[1]}' )
		Sysdisc3AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:ArrangementFee[1]}' )
		Sysdisc3AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:ArrangementFeeTax[1]}' )
		Sysdisc3IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:InternallyFundedDiscount[1]}' )
		Sysdisc3Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:Total[1]}' )
		func_write(payment,"SysDisc,Sysdisc3Net",product,Sysdisc3Net)
		func_write(payment,"SysDisc,Sysdisc3NetTax",product,Sysdisc3NetTax)
		func_write(payment,"SysDisc,Sysdisc3Commission",product,Sysdisc3Comm)
		func_write(payment,"SysDisc,Sysdisc3CommissionTax",product,Sysdisc3CommTax)
		func_write(payment,"SysDisc,Sysdisc3AAF",product,Sysdisc3AAF)
		func_write(payment,"SysDisc,Sysdisc3AAFTax",product,Sysdisc3AAFTax)
		func_write(payment,"SysDisc,Sysdisc3IFD",product,Sysdisc3IFD )
		func_write(payment,"SysDisc,Sysdisc3Total",product,Sysdisc3Total)
	}

	 //Policy price
	def P_CoreNet = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:NetRate[1]}' )
	def P_CoreNetTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:NetRateTax[1]}' )
	def P_CoreComm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:Commission[1]}' )
	def P_CoreCommTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:CommissionTax[1]}' )
	def P_TaxTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:TaxTotal[1]}' )
	def P_CoreTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:Total[1]}' )
	def P_AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:ArrangementFee[1]/tns1:Fee[1]}' )
	def P_AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:ArrangementFee[1]/tns1:FeeTax[1]}' )
	def P_AAFTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:ArrangementFee[1]/tns1:Total[1]}' )
	def P_CoreDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreDiscountsTotal[1]}' )
	def P_CoreDiscTaxTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreDiscountsTaxTotal[1]}' )
	def P_CoreCommDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreCommissionDiscountsTotal[1]}' )
	def P_CoreNetDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreNetRateDiscountsTotal[1]}' )
	def P_AAFGrandDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:ArrangementFeeGrandDiscountsTotal[1]}' )
	def P_AAFTaxDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:ArrangementFeeTaxDiscountsTotal[1]}' )
	def P_AAFDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:ArrangementFeeDiscountsTotal[1]}' )
	def P_ProdRel = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:RelativityPriceFactor[1]}' )
	def P_ProdAAFTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:ArrangementFeeTotal[1]}' )
	def P_ProdTotalLessAAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:TotalLessArrangementFeeTotal[1]}' )
	def P_ProdTotalLessDisc = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:TotalLessDiscounts[1]}' )
	def P_ProdTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:Total[1]}' )
	func_write(payment,"P_CORE,Net",product,P_CoreNet)
	func_write(payment,"P_CORE,NetTax",product,P_CoreNetTax)
	func_write(payment,"P_CORE,Commission",product,P_CoreComm)
	func_write(payment,"P_CORE,CommissionTax",product,P_CoreCommTax)
	func_write(payment,"P_CORE,TaxTotal",product,P_TaxTotal)
	func_write(payment,"P_CORE,Total",product,P_CoreTotal)
	func_write(payment,"P_AAF,AAF",product,P_AAF)
	func_write(payment,"P_AAF,AAFTax",product,P_AAFTax)
	func_write(payment,"P_AAF,Total",product,P_AAFTotal)

	//Policy Offer validation
	
	def OfferNode4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:Code[1]}' )
	def OfferNode5 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OFFER+'"]/tns1:Code[1]}' )
	def Offernet4,OffernetTax4,Offercomm4,OffercommTax4,OfferAAF4,OfferAAFTax4,OfferIFD4,OfferTotal4
	def Offernet5,OffernetTax5,Offercomm5,OffercommTax5,OfferAAF5,OfferAAFTax5,OfferIFD5,OfferTotal5
	if (OfferNode4 != "")//if NB offer exists in policy price
	{
		Offernet4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:NetRate[1]}' )
		OffernetTax4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:NetRateTax[1]}' )
		Offercomm4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:Commission[1]}' )
		OffercommTax4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:CommissionTax[1]}' )
		OfferAAF4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:ArrangementFee[1]}' )
		OfferAAFTax4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:ArrangementFeeTax[1]}' )
		OfferIFD4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:InternallyFundedDiscount[1]}' )
		OfferTotal4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:Total[1]}' )

		func_write(payment,"Offer4,Net",product,Offernet4)
		func_write(payment,"Offer4,NetTax",product,OffernetTax4)
		func_write(payment,"Offer4,Commission",product,Offercomm4)
		func_write(payment,"Offer4,CommissionTax",product,OffercommTax4)
		func_write(payment,"Offer4,AAF",product,OfferAAF4)
		func_write(payment,"Offer4,AAFTax",product,OfferAAFTax4)
		func_write(payment,"Offer4,IFD",product,OfferIFD4)
		func_write(payment,"Offer4,Total",product,OfferTotal4)
	}
	
	

	def AD4Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Code[1]}' )
	def AD5Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:Code[1]}' )
	def AD6Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:Code[1]}' )
	def AD4net,AD4netTax,AD4comm,AD4commTax,AD4AAF,AD4AAFTax,AD4IFD,AD4Total
	def AD5net,AD5netTax,AD5comm,AD5commTax,AD5AAF,AD5AAFTax,AD5IFD,AD5Total
	def AD6net,AD6netTax,AD6comm,AD6commTax,AD6AAF,AD6AAFTax,AD6IFD,AD6Total
	
	if (AD4Node != "") 
	{
		AD4net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:NetRate[1]}' )
		AD4netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:NetRateTax[1]}' )
		AD4comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Commission[1]}' )
		AD4commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:CommissionTax[1]}' )
		AD4AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:ArrangementFee[1]}' )
		AD4AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:ArrangementFeeTax[1]}' )
		AD4IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:InternallyFundedDiscount[1]}' )
		AD4Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Total[1]}' )
		

		func_write(payment,"AgentDisc,AD4Net",product,AD4net)
		func_write(payment,"AgentDisc,AD4NetTax",product,AD4netTax)
		func_write(payment,"AgentDisc,AD4Commission",product,AD4comm)
		func_write(payment,"AgentDisc,AD4CommissionTax",product,AD4commTax)
		func_write(payment,"AgentDisc,AD4AAF",product,AD4AAF)
		func_write(payment,"AgentDisc,AD4AAFTax",product,AD4AAFTax)
		func_write(payment,"AgentDisc,AD4IFD",product,AD4IFD )
		func_write(payment,"AgentDisc,AD4Total",product,AD4Total)
		
	}
	if(AD5Node != "") //if new AD1 exists and AD1 node present in policy price and  NB/RNL AD exists
	{
		AD5net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:NetRate[1]}' )
		AD5netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:NetRateTax[1]}' )
		AD5comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:Commission[1]}' )
		AD5commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:CommissionTax[1]}' )
		AD5AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:ArrangementFee[1]}' )
		AD5AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:ArrangementFeeTax[1]}' )
		AD5IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:InternallyFundedDiscount[1]}' )
		AD5Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:Total[1]}' )
		func_write(payment,"AgentDisc,AD5Net",product,AD5net)
		func_write(payment,"AgentDisc,AD5NetTax",product,AD5netTax)
		func_write(payment,"AgentDisc,AD5Commission",product,AD5comm)
		func_write(payment,"AgentDisc,AD5CommissionTax",product,AD5commTax)
		func_write(payment,"AgentDisc,AD5AAF",product,AD5AAF)
		func_write(payment,"AgentDisc,AD5AAFTax",product,AD5AAFTax,)
		func_write(payment,"AgentDisc,AD5IFD",product,AD5IFD, )
		func_write(payment,"AgentDisc,AD5Total",product,AD5Total)
	}

	if (AD6Node!="")
		{
			AD6net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:NetRate[1]}' )
			AD6netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:NetRateTax[1]}' )
			AD6comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:Commission[1]}' )
			AD6commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:CommissionTax[1]}' )
			AD6AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:ArrangementFee[1]}' )
			AD6AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:ArrangementFeeTax[1]}' )
			AD6IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:InternallyFundedDiscount[1]}' )
			AD6Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[3]/tns1:Total[1]}' )
			func_write(payment,"AgentDisc,AD6Net",product,AD6net)
			func_write(payment,"AgentDisc,AD6NetTax",product,AD6netTax)
			func_write(payment,"AgentDisc,AD6Commission",product,AD6comm)
			func_write(payment,"AgentDisc,AD6CommissionTax",product,AD6commTax)
			func_write(payment,"AgentDisc,AD6AAF",product,AD6AAF)
			func_write(payment,"AgentDisc,AD6AAFTax",product,AD6AAFTax,)
			func_write(payment,"AgentDisc,AD6IFD",product,AD6IFD, )
			func_write(payment,"AgentDisc,AD6Total",product,AD6Total)	
		}
	
	def Sysdisc4net,Sysdisc4netTax,Sysdisc4comm,Sysdisc4commTax,Sysdisc4AAF,Sysdisc4AAFTax,Sysdisc4IFD,Sysdisc4Total
	if (product == "HomeStart")
	{
		def Sysdisc4Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:Code[1]}' )
		if (Sysdisc4Node!="")
		{
			Sysdisc4net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:NetRate[1]}' )
			Sysdisc4netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:NetRateTax[1]}' )
			Sysdisc4comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:Commission[1]}' )
			Sysdisc4commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:CommissionTax[1]}' )
			Sysdisc4AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:ArrangementFee[1]}' )
			Sysdisc4AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:ArrangementFeeTax[1]}' )
			Sysdisc4IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:InternallyFundedDiscount[1]}' )
			Sysdisc4Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:Total[1]}' )
			func_write(payment,"SysDisc,Sysdisc4Net",product,Sysdisc4Net)
			func_write(payment,"SysDisc,Sysdisc4NetTax",product,Sysdisc4NetTax)
			func_write(payment,"SysDisc,Sysdisc4Commission",product,Sysdisc4Comm)
			func_write(payment,"SysDisc,Sysdisc4CommissionTax",product,Sysdisc4CommTax)
			func_write(payment,"SysDisc,Sysdisc4AAF",product,Sysdisc4AAF)
			func_write(payment,"SysDisc,Sysdisc4AAFTax",product,Sysdisc4AAFTax)
			func_write(payment,"SysDisc,Sysdisc4IFD",product,Sysdisc4IFD )
			func_write(payment,"SysDisc,Sysdisc4Total",product,Sysdisc4Total)
		}
	}
	def Sysdisc5net,Sysdisc5netTax,Sysdisc5comm,Sysdisc5commTax,Sysdisc5AAF,Sysdisc5AAFTax,Sysdisc5IFD,Sysdisc5Total
	def Sysdisc5Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:Code[1]}' )
		if (Sysdisc5Node!="")
		{
			Sysdisc5net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:NetRate[1]}' )
			Sysdisc5netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:NetRateTax[1]}' )
			Sysdisc5comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:Commission[1]}' )
			Sysdisc5commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:CommissionTax[1]}' )
			Sysdisc5AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:ArrangementFee[1]}' )
			Sysdisc5AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:ArrangementFeeTax[1]}' )
			Sysdisc5IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:InternallyFundedDiscount[1]}' )
			Sysdisc5Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:Total[1]}' )
			func_write(payment,"SysDisc,Sysdisc5Net",product,Sysdisc5Net)
			func_write(payment,"SysDisc,Sysdisc5NetTax",product,Sysdisc5NetTax)
			func_write(payment,"SysDisc,Sysdisc5Commission",product,Sysdisc5Comm)
			func_write(payment,"SysDisc,Sysdisc5CommissionTax",product,Sysdisc5CommTax)
			func_write(payment,"SysDisc,Sysdisc5AAF",product,Sysdisc5AAF)
			func_write(payment,"SysDisc,Sysdisc5AAFTax",product,Sysdisc5AAFTax)
			func_write(payment,"SysDisc,Sysdisc5IFD",product,Sysdisc5IFD )
			func_write(payment,"SysDisc,Sysdisc5Total",product,Sysdisc5Total)
		}
	func_write(payment,"P_CoreDiscTotal",product,P_CoreDiscTotal)
	func_write(payment,"P_CoreDiscTaxTotal",product,P_CoreDiscTaxTotal)
	func_write(payment,"P_CoreCommDiscTotal",product,P_CoreCommDiscTotal)
	func_write(payment,"P_CoreNetDiscTotal",product,P_CoreNetDiscTotal)
	func_write(payment,"P_AAFGrandDiscTotal",product,P_AAFGrandDiscTotal)
	func_write(payment,"P_AAFTaxDiscTotal",product,P_AAFTaxDiscTotal)
	func_write(payment,"P_AAFDiscTotal",product,P_AAFDiscTotal)
	func_write(payment,"P_RelFactor",product,P_ProdRel)
	func_write(payment,"P_AAFTotal",product,P_ProdAAFTotal)
	func_write(payment,"P_TotalLessAAFTotal",product,P_ProdTotalLessAAF)
	func_write(payment,"P_TotalLessDisc",product,P_ProdTotalLessDisc)
	func_write(payment,"P_ProductTotal",product,P_ProdTotal)
	
}




def func_write (payment,element,name,RadarValue)
{
	int totalOfValuesChecked = Integer.parseInt(context.expand( '${#TestCase#TotalOfValuesChecked}' ))
	def prodType = context.expand( '${658All#NEWPRODUCT}' )

	if (context.expand('${658All#NEWBRC}') == "Y")
	{
		Car1 = context.expand( '${658All#NewCar1}' )
		Car2 = context.expand( '${658All#NewCar2}' )
		Car3 = context.expand( '${658All#NewCar3}' )
		Car4 = context.expand( '${658All#NewCar4}' )
		if (Car4 != "")
		{
			product_type = prodType + "(" + "Car1:" + Car1 + ",Car2:" + Car2 + ",Car3:" + Car3 + ",Car4:" + Car4 + ")"
		}
		else if (Car3 != "")
		{
			product_type = prodType + "(" + "Car1:" + Car1 + ",Car2:" + Car2 + ",Car3:" + Car3 + ")"
		}
		else if (Car2 != "")
		{
			product_type = prodType + "("  + "Car1:" + Car1 + ",Car2:" + Car2 + ")"
		}
		else
		{
			product_type = prodType + "(" + "Car1:" + Car1 + ")"
		}
	}
	else
	{
		product_type = context.expand( '${658All#NEWPRODUCT}' )
	}

	if (name == "BasicBreakdown" || name == "LocalDriver" ||  name == "ROCO" || name ==  "ROPOV" || name == "Standby" ||  name == "StartUp" )
	{
		 name= "Roadside"
	}
	log.info Pass=(context.expand('${658All#ID}') + "|" + context.expand( '${658All#NB/RNL Offer}' ) + "|"  + payment + "|" + product_type + "|" + context.expand( '${658All#NewCover_type}' ) + "|" + name + "|" + element + "| " + RadarValue )

	
	
	BufferedWriter bw = new BufferedWriter (new FileWriter (context.expand('${#TestCase#ResultFile}'), true));
	bw.write (Pass);
	bw.newLine();
	bw.flush();
	bw.close();
	totalOfValuesChecked++
	testRunner.testCase.setPropertyValue( 'totalOfValuesChecked',  new Integer(totalOfValuesChecked).toString())
	
}</script>
    </con:config>
  </con:testStep>
  <con:testStep type="datasourceloop" name="DataSource Loop" id="bb507222-1380-4dc2-a0d8-25394dc41431">
    <con:settings/>
    <con:config>
      <dataSourceStep>408RoadAll</dataSourceStep>
      <targetStep>Setup_NBR_ProductList_XML</targetStep>
      <discardResults>false</discardResults>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Log Results" id="4af151ea-7b2a-463d-86cb-bc4c1bd6a702">
    <con:settings/>
    <con:config>
      <script>log.info("    ********************************")
log.info("    ************RESULTS*************")
log.info("    Number of Iterations: " + context.expand( '${#TestCase#NumOfIterations}' ))
log.info("    Number of Values Checked: " + context.expand( '${#TestCase#TotalOfValuesChecked}' ))
//log.info("    Number of Failed values: " + context.expand( '${#TestCase#NumOfValuesFailed}' ))
log.info("    Request Date Time: " + context.expand( '${#TestCase#RequestDateTime}' ))
log.info("    ********************************")
log.info("    ********************************")

NumberofIterations = ("    Number of Iterations: " + context.expand( '${#TestCase#NumOfIterations}'));
NumberofValuesChecked = ("    Number of Values Checked: " + context.expand( '${#TestCase#TotalOfValuesChecked}' ));
//NumberofFailedValues = ("    Number of Failed values: " + context.expand( '${#TestCase#NumOfValuesFailed}' ));
RequestDateTime = ("    RequestDateTime: " + context.expand( '${#TestCase#RequestDateTime}' ));

BufferedWriter bw = new BufferedWriter (new FileWriter (context.expand('${#TestCase#File}'), true));
bw.write (NumberofIterations);
bw.newLine();
bw.write (NumberofValuesChecked);
bw.newLine();
//bw.write (NumberofFailedValues);
//bw.newLine();
bw.write (RequestDateTime);
bw.newLine();
bw.flush();
bw.close();</script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Groovy Script" id="f215f197-fb33-4563-99ac-be2572be5529" disabled="true">
    <con:settings/>
    <con:config>
      <script>Code = "SM"

def paidPeriod_SM = context.expand( '${408RoadAll#PaidPeriod_'+Code+'}' )

log.info( paidPeriod_SM )
//log.info("&lt;prod:PaidPeriods>"+ context.expand( '${408RoadAll#PaidPeriod_"'+Code+'"}' ) +" &lt;/prod:PaidPeriods>")</script>
    </con:config>
  </con:testStep>
  <con:testStep type="groovy" name="Copy of Validate" id="44182578-0674-416b-88b4-a24d854fb4ba" disabled="true">
    <con:settings/>
    <con:config>
      <script><![CDATA[def numOfIterations = context.expand( '${#TestCase#NumOfIterations}' )
numOfIterations++
testRunner.testCase.setPropertyValue("NumOfIterations", numOfIterations.toString())
def id = context.expand( '${658All#ID}' )
def payment = context.expand( '${658All#Payment type}' )
log.info id

// Check what Products to validate for transaction price
def productType = context.expand( '${658All#NEWPRODUCT}' )
String delimiters = "\\,|\\&";
String[] prodArr = productType.split(delimiters);
StringBuilder strBld = new StringBuilder();

//validate individual product
if(prodArr.length > 0)
{
	for (prod in prodArr)
	{
		if(prod.trim().equals("Roadside"))
		{
			product= "Roadside"
			func_Check(productType,product,"RO",payment,id)
		}
		
		if(prod.trim().equals("Home Start"))
		{
			product= "HomeStart"
			func_Check(productType,product,"HS",payment,id)
		}
		if(prod.trim().equals("Relay"))
		{
			product= "Relay"
			func_Check(productType,product,"RE",payment,id)
		}
		if(prod.trim().equals("Stay Mobile"))
		{
			product= "StayMobile"
			func_Check(productType,product,"SM",payment,id)
		}	
	}
}
if(context.expand( '${658All#BRC}' )=="Y")
{
	product= "BRC"
	func_Check(productType,product,"BRC",payment,id)
}		

def func_Check(productType,product,name,payment,id)
{
	log.info product
	log.info id
	//Transaction price
	def CoreNet = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:NetRate[1]}' )
	def CoreNetTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:NetRateTax[1]}' )
	def CoreComm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:Commission[1]}' )
	def CoreCommTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:CommissionTax[1]}' )
	def TaxTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:TaxTotal[1]}' )
	def CoreTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:Total[1]}' )
	def AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:ArrangementFee[1]/tns1:Fee[1]}' )
	def AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:ArrangementFee[1]/tns1:FeeTax[1]}' )
	def AAFTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:ArrangementFee[1]/tns1:Total[1]}' )
	def CoreDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreDiscountsTotal[1]}' )
	def CoreDiscTaxTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreDiscountsTaxTotal[1]}' )
	def CoreCommDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreCommissionDiscountsTotal[1]}' )
	def CoreNetDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreNetRateDiscountsTotal[1]}' )
	def AAFGrandDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:ArrangementFeeGrandDiscountsTotal[1]}' )
	def AAFTaxDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:ArrangementFeeTaxDiscountsTotal[1]}' )
	def AAFDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:ArrangementFeeDiscountsTotal[1]}' )
	def ProdRel = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:RelativityPriceFactor[1]}' )
	def ProdAAFTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:ArrangementFeeTotal[1]}' )
	def ProdTotalLessAAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:TotalLessArrangementFeeTotal[1]}' )
	def ProdTotalLessDisc = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:TotalLessDiscounts[1]}' )
	def ProdTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:Total[1]}' )

	func_write(payment,"CORE,Net",product,CoreNet)
	func_write(payment,"CORE,NetTax",product,CoreNetTax)
	func_write(payment,"CORE,Commission",product,CoreComm)
	func_write(payment,"CORE,CommissionTax",product,CoreCommTax)
	func_write(payment,"CORE,TaxTotal",product,TaxTotal)
	func_write(payment,"CORE,Total",product,CoreTotal)
	func_write(payment,"AAF,AAF",product,AAF)
	func_write(payment,"AAF,AAFTax",product,AAFTax)
	func_write(payment,"AAF,Total",product,AAFTotal)
	func_write(payment,"AccountingTotals,CoreDiscTotal",product,CoreDiscTotal)
	func_write(payment,"AccountingTotals,CoreDiscTaxTotal",product,CoreDiscTaxTotal)
	func_write(payment,"AccountingTotals,CoreCommDiscTotal",product,CoreCommDiscTotal)
	func_write(payment,"AccountingTotals,CoreNetDiscTotal",product,CoreNetDiscTotal)
	func_write(payment,"AccountingTotals,AAFGrandDiscTotal",product,AAFGrandDiscTotal)
	func_write(payment,"AccountingTotals,AAFTaxDiscTotal",product,AAFTaxDiscTotal)
	func_write(payment,"AccountingTotals,AAFDiscTotal",product,AAFDiscTotal)
	func_write(payment,"RelFactor",product,ProdRel)
	func_write(payment,"AAFTotal",product,AAFTotal)
	func_write(payment,"TotalLessAAFTotal",product,ProdTotalLessAAF)
	func_write(payment,"TotalLessDisc",product,ProdTotalLessDisc)
	func_write(payment,"ProductTotal",product,ProdTotal)

	//Transaction Offer validation
	def OFFER = ""
	def OLDOFFER = context.expand( '${658All#NB/RNL Offer}' )
	def OfferNode = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OFFER+'"]/tns1:Code[1]}' )
	def Offernet3,OffernetTax3,Offercomm3,OffercommTax3,OfferAAF3,OfferAAFTax3,OfferIFD3,OfferTotal3
	
	if (OLDOFFER !="" && OFFER != OLDOFFER) // if old offer needs to be clawed back
	{
		def OldOfferNode = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:Code[1]}' )
		if (OldOfferNode !="")
		{
			Offernet3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:NetRate[1]}' )
			OffernetTax3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:NetRateTax[1]}' )
			Offercomm3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:Commission[1]}' )
			OffercommTax3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:CommissionTax[1]}' )
			OfferAAF3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:ArrangementFee[1]}' )
			OfferAAFTax3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:ArrangementFeeTax[1]}' )
			OfferIFD3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:InternallyFundedDiscount[1]}' )
			OfferTotal3 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:Total[1]}' )

			func_write(payment,"Offer3,Net",product,Offernet3)
			func_write(payment,"Offer3,NetTax",product,OffernetTax3)
			func_write(payment,"Offer3,Commission",product,Offercomm3)
			func_write(payment,"Offer3,CommissionTax",product,OffercommTax3)
			func_write(payment,"Offer3,AAF",product,OfferAAF3)
			func_write(payment,"Offer3,AAFTax",product,OfferAAFTax3)
			func_write(payment,"Offer3,IFD",product,OfferIFD3)
			func_write(payment,"Offer3,Total",product,OfferTotal3)
		}
	}

	//Transaction AD validation
	def AD1 = context.expand( '${658All#MTA AD}' )
	//def AD2 = context.expand( '${408RoadAll#MTA AGENT DISCOUNT2}' )
	def AD1Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Code[1]}' )
	//def AD2Node = context.expand( '${ID'+id+'#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:Code[1]}' )
	def AD1net,AD1netTax,AD1comm,AD1commTax,AD1AAF,AD1AAFTax,AD1IFD,AD1Total,AD2net,AD2netTax,AD2comm,AD2commTax,AD2AAF,AD2AAFTax,AD2IFD,AD2Total
	
	if (AD1 !="0" && AD1Node != "") //if new AD1 exists and AD1 node present
	{
		AD1net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:NetRate[1]}' )
		AD1netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:NetRateTax[1]}' )
		AD1comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Commission[1]}' )
		AD1commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:CommissionTax[1]}' )
		AD1AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:ArrangementFee[1]}' )
		AD1AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:ArrangementFeeTax[1]}' )
		AD1IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:InternallyFundedDiscount[1]}' )
		AD1Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Total[1]}' )
	
		func_write(payment,"AgentDisc,AD1Net",product,AD1net)
		func_write(payment,"AgentDisc,AD1NetTax",product,AD1netTax)
		func_write(payment,"AgentDisc,AD1Commission",product,AD1comm)
		func_write(payment,"AgentDisc,AD1CommissionTax",product,AD1commTax)
		func_write(payment,"AgentDisc,AD1AAF",product,AD1AAF)
		func_write(payment,"AgentDisc,AD1AAFTax",product,AD1AAFTax)
		func_write(payment,"AgentDisc,AD1IFD",product,AD1IFD)
		func_write(payment,"AgentDisc,AD1Total",product,AD1Total)
	}

	
	def AD3 = context.expand( '${658All#NB/RNL AD}' )
	def AD3net,AD3netTax,AD3comm,AD3commTax,AD3AAF,AD3AAFTax,AD3IFD,AD3Total
	if (AD3==1 || AD3==2 ) //When Old AD needs to be clawed back  and no MTA AD exists
	{
		def AD3Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Code[1]}' )
		if (AD3Node!="")
		{
			AD3net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:NetRate[1]}' )
			AD3netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:NetRateTax[1]}' )
			AD3comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Commission[1]}' )
			AD3commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:CommissionTax[1]}' )
			AD3AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:ArrangementFee[1]}' )
			AD3AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:ArrangementFeeTax[1]}' )
			AD3IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:InternallyFundedDiscount[1]}' )
			AD3Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Total[1]}' )

			func_write(payment,"AgentDisc,AD3Net",product,AD3net)
			func_write(payment,"AgentDisc,AD3NetTax",product,AD3netTax)
			func_write(payment,"AgentDisc,AD3Commission",product,AD3comm)
			func_write(payment,"AgentDisc,AD3CommissionTax",product,AD3commTax)
			func_write(payment,"AgentDisc,AD3AAF",product,AD3AAF)
			func_write(payment,"AgentDisc,AD3AAFTax",product,AD3AAFTax)
			func_write(payment,"AgentDisc,AD3IFD",product,AD3IFD)
			func_write(payment,"AgentDisc,AD3Total",product,AD3Total)		
		}

		if ( AD3==2)
		{

		}
	}

	def Sysdisc1Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:Code[1]}' )
	log.info Sysdisc1Node
	def Sysdisc1net,Sysdisc1netTax,Sysdisc1comm,Sysdisc1commTax,Sysdisc1AAF,Sysdisc1AAFTax,Sysdisc1IFD,Sysdisc1Total
	if (Sysdisc1Node!="")
	{
		Sysdisc1net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:NetRate[1]}' )
		Sysdisc1netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:NetRateTax[1]}' )
		Sysdisc1comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:Commission[1]}' )
		Sysdisc1commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:CommissionTax[1]}' )
		Sysdisc1AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:ArrangementFee[1]}' )
		Sysdisc1AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:ArrangementFeeTax[1]}' )
		Sysdisc1IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:InternallyFundedDiscount[1]}' )
		Sysdisc1Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOREFUND"]/tns1:Total[1]}' )
		func_write(payment,"SysDisc,Sysdisc1Net",product,Sysdisc1Net)
		func_write(payment,"SysDisc,Sysdisc1NetTax",product,Sysdisc1NetTax)
		func_write(payment,"SysDisc,Sysdisc1Commission",product,Sysdisc1Comm)
		func_write(payment,"SysDisc,Sysdisc1CommissionTax",product,Sysdisc1CommTax)
		func_write(payment,"SysDisc,Sysdisc1AAF",product,Sysdisc1AAF)
		func_write(payment,"SysDisc,Sysdisc1AAFTax",product,Sysdisc1AAFTax)
		func_write(payment,"SysDisc,Sysdisc1IFD",product,Sysdisc1IFD)
		func_write(payment,"SysDisc,Sysdisc1Total",product,Sysdisc1Total)
	}

	def Sysdisc2Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:Code[1]}' )
	log.info Sysdisc2Node
	def Sysdisc2net,Sysdisc2netTax,Sysdisc2comm,Sysdisc2commTax,Sysdisc2AAF,Sysdisc2AAFTax,Sysdisc2IFD,Sysdisc2Total
	if (Sysdisc2Node!="")
	{
		Sysdisc2net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:NetRate[1]}' )
		Sysdisc2netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:NetRateTax[1]}' )
		Sysdisc2comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:Commission[1]}' )
		Sysdisc2commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:CommissionTax[1]}' )
		Sysdisc2AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:ArrangementFee[1]}' )
		Sysdisc2AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:ArrangementFeeTax[1]}' )
		Sysdisc2IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:InternallyFundedDiscount[1]}' )
		Sysdisc2Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:Total[1]}' )
		func_write(payment,"SysDisc,Sysdisc2Net",product,Sysdisc2Net)
		func_write(payment,"SysDisc,Sysdisc2NetTax",product,Sysdisc2NetTax)
		func_write(payment,"SysDisc,Sysdisc2Commission",product,Sysdisc2Comm)
		func_write(payment,"SysDisc,Sysdisc2CommissionTax",product,Sysdisc2CommTax)
		func_write(payment,"SysDisc,Sysdisc2AAF",product,Sysdisc2AAF)
		func_write(payment,"SysDisc,Sysdisc2AAFTax",product,Sysdisc2AAFTax)
		func_write(payment,"SysDisc,Sysdisc2IFD",product,Sysdisc2IFD)
		func_write(payment,"SysDisc,Sysdisc2Total",product,Sysdisc2Total)
		
	}

	def Sysdisc3Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:Code[1]}' )
	log.info Sysdisc3Node
	def Sysdisc3net,Sysdisc3netTax,Sysdisc3comm,Sysdisc3commTax,Sysdisc3AAF,Sysdisc3AAFTax,Sysdisc3IFD,Sysdisc3Total
	if (Sysdisc3Node!="")
	{
		Sysdisc3net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:NetRate[1]}' )
		Sysdisc3netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:NetRateTax[1]}' )
		Sysdisc3comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:Commission[1]}' )
		Sysdisc3commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:CommissionTax[1]}' )
		Sysdisc3AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:ArrangementFee[1]}' )
		Sysdisc3AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:ArrangementFeeTax[1]}' )
		Sysdisc3IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:InternallyFundedDiscount[1]}' )
		Sysdisc3Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:Price[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:Total[1]}' )
		func_write(payment,"SysDisc,Sysdisc3Net",product,Sysdisc3Net)
		func_write(payment,"SysDisc,Sysdisc3NetTax",product,Sysdisc3NetTax)
		func_write(payment,"SysDisc,Sysdisc3Commission",product,Sysdisc3Comm)
		func_write(payment,"SysDisc,Sysdisc3CommissionTax",product,Sysdisc3CommTax)
		func_write(payment,"SysDisc,Sysdisc3AAF",product,Sysdisc3AAF)
		func_write(payment,"SysDisc,Sysdisc3AAFTax",product,Sysdisc3AAFTax)
		func_write(payment,"SysDisc,Sysdisc3IFD",product,Sysdisc3IFD )
		func_write(payment,"SysDisc,Sysdisc3Total",product,Sysdisc3Total)
	}
	

	
	
	
	 //Policy price
	def P_CoreNet = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:NetRate[1]}' )
	def P_CoreNetTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:NetRateTax[1]}' )
	def P_CoreComm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:Commission[1]}' )
	def P_CoreCommTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:CommissionTax[1]}' )
	def P_TaxTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:TaxTotal[1]}' )
	def P_CoreTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:CorePrice[1]/tns1:Total[1]}' )
	def P_AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:ArrangementFee[1]/tns1:Fee[1]}' )
	def P_AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:ArrangementFee[1]/tns1:FeeTax[1]}' )
	def P_AAFTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:ArrangementFee[1]/tns1:Total[1]}' )
	def P_CoreDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreDiscountsTotal[1]}' )
	def P_CoreDiscTaxTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreDiscountsTaxTotal[1]}' )
	def P_CoreCommDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreCommissionDiscountsTotal[1]}' )
	def P_CoreNetDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:CoreNetRateDiscountsTotal[1]}' )
	def P_AAFGrandDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:ArrangementFeeGrandDiscountsTotal[1]}' )
	def P_AAFTaxDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:ArrangementFeeTaxDiscountsTotal[1]}' )
	def P_AAFDiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AccountingTotals[1]/tns1:ArrangementFeeDiscountsTotal[1]}' )
	def P_ProdRel = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:RelativityPriceFactor[1]}' )
	def P_ProdAAFTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:ArrangementFeeTotal[1]}' )
	def P_ProdTotalLessAAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:TotalLessArrangementFeeTotal[1]}' )
	def P_ProdTotalLessDisc = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:TotalLessDiscounts[1]}' )
	def P_ProdTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:Total[1]}' )
	func_write(payment,"P_CORE,Net",product,P_CoreNet)
	func_write(payment,"P_CORE,NetTax",product,P_CoreNetTax)
	func_write(payment,"P_CORE,Commission",product,P_CoreComm)
	func_write(payment,"P_CORE,CommissionTax",product,P_CoreCommTax)
	func_write(payment,"P_CORE,TaxTotal",product,P_TaxTotal)
	func_write(payment,"P_CORE,Total",product,P_CoreTotal)
	func_write(payment,"P_AAF,AAF",product,P_AAF)
	func_write(payment,"P_AAF,AAFTax",product,P_AAFTax)
	func_write(payment,"P_AAF,Total",product,P_AAFTotal)
	func_write(payment,"P_AccountingTotals,CoreDiscTotal",product,P_CoreDiscTotal)
	func_write(payment,"P_AccountingTotals,CoreDiscTaxTotal",product,P_CoreDiscTaxTotal)
	func_write(payment,"P_AccountingTotals,CoreCommDiscTotal",product,P_CoreCommDiscTotal)
	func_write(payment,"P_AccountingTotals,CoreNetDiscTotal",product,P_CoreNetDiscTotal)
	func_write(payment,"P_AccountingTotals,AAFGrandDiscTotal",product,P_AAFGrandDiscTotal)
	func_write(payment,"P_AccountingTotals,AAFTaxDiscTotal",product,P_AAFTaxDiscTotal)
	func_write(payment,"P_AccountingTotals,AAFDiscTotal",product,P_AAFDiscTotal)
	func_write(payment,"P_Total,RelFactor",product,P_ProdRel)
	func_write(payment,"P_Total,AAFTotal",product,P_AAFTotal)
	func_write(payment,"P_Total,TotalLessAAFTotal",product,P_ProdTotalLessAAF)
	func_write(payment,"P_Total,TotalLessDisc",product,P_ProdTotalLessDisc)
	func_write(payment,"P_Total,ProductTotal",product,P_ProdTotal)
	//Policy Offer validation
	
	def OfferNode4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:Code[1]}' )
	def OfferNode5 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OFFER+'"]/tns1:Code[1]}' )
	def Offernet4,OffernetTax4,Offercomm4,OffercommTax4,OfferAAF4,OfferAAFTax4,OfferIFD4,OfferTotal4
	def Offernet5,OffernetTax5,Offercomm5,OffercommTax5,OfferAAF5,OfferAAFTax5,OfferIFD5,OfferTotal5
	if (OfferNode4 != "")//if NB offer exists in policy price
	{
		Offernet4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:NetRate[1]}' )
		OffernetTax4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:NetRateTax[1]}' )
		Offercomm4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:Commission[1]}' )
		OffercommTax4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:CommissionTax[1]}' )
		OfferAAF4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:ArrangementFee[1]}' )
		OfferAAFTax4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:ArrangementFeeTax[1]}' )
		OfferIFD4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:InternallyFundedDiscount[1]}' )
		OfferTotal4 = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:OfferCodeDiscountList[1]/tns1:OfferCodeDiscount[tns1:Code ="'+OLDOFFER+'"]/tns1:Total[1]}' )

		func_write(payment,"Offer4,Net",product,Offernet4)
		func_write(payment,"Offer4,NetTax",product,OffernetTax4)
		func_write(payment,"Offer4,Commission",product,Offercomm4)
		func_write(payment,"Offer4,CommissionTax",product,OffercommTax4)
		func_write(payment,"Offer4,AAF",product,OfferAAF4)
		func_write(payment,"Offer4,AAFTax",product,OfferAAFTax4)
		func_write(payment,"Offer4,IFD",product,OfferIFD4)
		func_write(payment,"Offer4,Total",product,OfferTotal4)
	}
	
	}

	//Policy AD validation

	def AD4Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Code[1]}' )
	def AD6Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:Code[1]}' )
	def AD4net,AD4netTax,AD4comm,AD4commTax,AD4AAF,AD4AAFTax,AD4IFD,AD4Total
	def AD5net,AD5netTax,AD5comm,AD5commTax,AD5AAF,AD5AAFTax,AD5IFD,AD5Total
	def AD6net,AD6netTax,AD6comm,AD6commTax,AD6AAF,AD6AAFTax,AD6IFD,AD6Total
def AD3 = context.expand( '${658All#NB/RNL AD}' )
def AD1 = ""
	if (AD1 !="" && AD4Node != "") //if new AD1 exists and AD1 node present in policy price and no NB/RNL AD exists
	{
		AD4net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:NetRate[1]}' )
		AD4netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:NetRateTax[1]}' )
		AD4comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Commission[1]}' )
		AD4commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:CommissionTax[1]}' )
		AD4AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:ArrangementFee[1]}' )
		AD4AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:ArrangementFeeTax[1]}' )
		AD4IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:InternallyFundedDiscount[1]}' )
		AD4Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Total[1]}' )
		func_write(payment,"AgentDisc,AD4Net",product,AD4net)
		func_write(payment,"AgentDisc,AD4NetTax",product,AD4netTax)
		func_write(payment,"AgentDisc,AD4Commission",product,AD4comm)
		func_write(payment,"AgentDisc,AD4CommissionTax",product,AD4commTax)
		func_write(payment,"AgentDisc,AD4AAF",product,AD4AAF)
		func_write(payment,"AgentDisc,AD4AAFTax",product,AD4AAFTax)
		func_write(payment,"AgentDisc,AD4IFD",product,AD4IFD )
		func_write(payment,"AgentDisc,AD4Total",product,AD4Total)
	}
	else if(AD3!= "" &&  AD1 !="" && AD4Node != "") //if new AD1 exists and AD1 node present in policy price and  NB/RNL AD exists
	{
		AD4net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:NetRate[1]}' )
		AD4netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:NetRateTax[1]}' )
		AD4comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:Commission[1]}' )
		AD4commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:CommissionTax[1]}' )
		AD4AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2/tns1:ArrangementFee[1]}' )
		AD4AAFTax = context.expand( '${MTA RequestResponse#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:ArrangementFeeTax[1]}' )
		AD4IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:InternallyFundedDiscount[1]}' )
		AD4Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[2]/tns1:Total[1]}' )
		func_write(payment,"AgentDisc,AD4Net",product,AD4net)
		func_write(payment,"AgentDisc,AD4NetTax",product,AD4netTax)
		func_write(payment,"AgentDisc,AD4Commission",product,AD4comm)
		func_write(payment,"AgentDisc,AD4CommissionTax",product,AD4commTax)
		func_write(payment,"AgentDisc,AD4AAF",product,AD4AAF)
		func_write(payment,"AgentDisc,AD4AAFTax",product,AD4AAFTax,)
		func_write(payment,"AgentDisc,AD4IFD",product,AD4IFD, )
		func_write(payment,"AgentDisc,AD4Total",product,AD4Total)
	}

	if (AD3!="") //When Old AD needs to be clawed back  and no MTA AD exists
	{
		def AD5Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Code[1]}' )
		if (AD5Node!="")
		{
			AD5net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:NetRate[1]}' )
			AD5netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:NetRateTax[1]}' )
			AD5comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Commission[1]}' )
			AD5commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:CommissionTax[1]}' )
			AD5AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:ArrangementFee[1]}' )
			AD5AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:ArrangementFeeTax[1]}' )
			AD5IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:InternallyFundedDiscount[1]}' )
			AD5Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:AgentDiscountList[1]/tns1:AgentDiscount[1]/tns1:Total[1]}' )
			func_write(payment,"AgentDisc,AD5Net",product,AD5net)
			func_write(payment,"AgentDisc,AD5NetTax",product,AD5netTax)
			func_write(payment,"AgentDisc,AD5Commission",product,AD5comm)
			func_write(payment,"AgentDisc,AD5CommissionTax",product,AD5commTax)
			func_write(payment,"AgentDisc,AD5AAF",product,AD5AAF)
			func_write(payment,"AgentDisc,AD5AAFTax",product,AD5AAFTax,)
			func_write(payment,"AgentDisc,AD5IFD",product,AD5IFD, )
			func_write(payment,"AgentDisc,AD5Total",product,AD5Total)	
		}
	}
	def Sysdisc4net,Sysdisc4netTax,Sysdisc4comm,Sysdisc4commTax,Sysdisc4AAF,Sysdisc4AAFTax,Sysdisc4IFD,Sysdisc4Total
	if (product == "HomeStart")
	{
		def Sysdisc4Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:Code[1]}' )
		if (Sysdisc4Node!="")
		{
			Sysdisc4net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:NetRate[1]}' )
			Sysdisc4netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:NetRateTax[1]}' )
			Sysdisc4comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:Commission[1]}' )
			Sysdisc4commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:CommissionTax[1]}' )
			Sysdisc4AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:ArrangementFee[1]}' )
			Sysdisc4AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:ArrangementFeeTax[1]}' )
			Sysdisc4IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:InternallyFundedDiscount[1]}' )
			Sysdisc4Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOTNEG"]/tns1:Total[1]}' )
			func_write(payment,"SysDisc,Sysdisc4Net",product,Sysdisc4Net)
			func_write(payment,"SysDisc,Sysdisc4NetTax",product,Sysdisc4NetTax)
			func_write(payment,"SysDisc,Sysdisc4Commission",product,Sysdisc4Comm)
			func_write(payment,"SysDisc,Sysdisc4CommissionTax",product,Sysdisc4CommTax)
			func_write(payment,"SysDisc,Sysdisc4AAF",product,Sysdisc4AAF)
			func_write(payment,"SysDisc,Sysdisc4AAFTax",product,Sysdisc4AAFTax)
			func_write(payment,"SysDisc,Sysdisc4IFD",product,Sysdisc4IFD )
			func_write(payment,"SysDisc,Sysdisc4Total",product,Sysdisc4Total)
		}
	}
	def Sysdisc5net,Sysdisc5netTax,Sysdisc5comm,Sysdisc5commTax,Sysdisc5AAF,Sysdisc5AAFTax,Sysdisc5IFD,Sysdisc5Total
	def Sysdisc5Node = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:Code[1]}' )
		if (Sysdisc5Node!="")
		{
			Sysdisc5net = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:NetRate[1]}' )
			Sysdisc5netTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:NetRateTax[1]}' )
			Sysdisc5comm = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:Commission[1]}' )
			Sysdisc5commTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:CommissionTax[1]}' )
			Sysdisc5AAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:ArrangementFee[1]}' )
			Sysdisc5AAFTax = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:ArrangementFeeTax[1]}' )
			Sysdisc5IFD = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:InternallyFundedDiscount[1]}' )
			Sysdisc5Total = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:Product[tns1:ProductPriceName ="'+product+'"]/tns1:PriceList[1]/tns1:PolicyPrice[1]/tns1:PriceBreakdown[1]/tns1:SystemDiscountList[1]/tns1:SystemDiscount[tns1:Code ="NOCHARGE"]/tns1:Total[1]}' )
			func_write(payment,"SysDisc,Sysdisc5Net",product,Sysdisc5Net)
			func_write(payment,"SysDisc,Sysdisc5NetTax",product,Sysdisc5NetTax)
			func_write(payment,"SysDisc,Sysdisc5Commission",product,Sysdisc5Comm)
			func_write(payment,"SysDisc,Sysdisc5CommissionTax",product,Sysdisc5CommTax)
			func_write(payment,"SysDisc,Sysdisc5AAF",product,Sysdisc5AAF)
			func_write(payment,"SysDisc,Sysdisc5AAFTax",product,Sysdisc5AAFTax)
			func_write(payment,"SysDisc,Sysdisc5IFD",product,Sysdisc5IFD )
			func_write(payment,"SysDisc,Sysdisc5Total",product,Sysdisc5Total)
		}

	




//Transaction Price Breakdown
def GrandTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:Total[1]}' )
def GrandTotalExcDisc = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalExcludingDiscounts[1]}' )
def DiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:DiscountTotal[1]}' )
def BaseCoverTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:BaseCoverTotal[1]}' )
def BaseCoverTotalLessDisc = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:BaseCoverTotalLessDiscounts[1]}' )
def BaseCoverAAFTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:BaseCoverArrangementFeeTotal[1]}' )
def TotalAAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalArrangementFee[1]}' )
def FeeTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:SurchargeFeeTotal[1]}' )
def TotalLessTotalAAFAddons = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalLessTotalAAFAndTotalAddons[1]}' )
def TotalLessFees = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalLessSurchargeFees[1]}' )
def TotalLessAAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalLessArrangementFees[1]}' )
def TotalIPT = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalIPT[1]}' )
def TotalVAT = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:TotalPriceBreakdown[1]/tns1:TotalVAT[1]}' )
def TransSubType = context.expand( '${658Request#Response#declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:TransactionSubType[1]}' )

	func_write(payment,"TotalPriceBreakdown,CombinedTotal","",GrandTotal)
	func_write(payment,"TotalPriceBreakdown,TotalLessDisc","",GrandTotalExcDisc)
	func_write(payment,"TotalPriceBreakdown,DiscountsTotal","",DiscTotal)
	func_write(payment,"TotalPriceBreakdown,BaseCoverTotal","",BaseCoverTotal)
	func_write(payment,"TotalPriceBreakdown,BaseCoverLessDisc","",BaseCoverTotalLessDisc)
	func_write(payment,"TotalPriceBreakdown,BaseCoverAAFTotal","",BaseCoverAAFTotal)
	func_write(payment,"TotalPriceBreakdown,TotalAAF","",TotalAAF)
	func_write(payment,"TotalPriceBreakdown,TotalFee","",FeeTotal)
	func_write(payment,"TotalPriceBreakdown,TotalLessAAFLessAddons","",TotalLessTotalAAFAddons)
	func_write(payment,"TotalPriceBreakdown,TotalLessFee","",TotalLessFees)
	func_write(payment,"TotalPriceBreakdown,TotalLessAAF","",TotalLessAAF)
	func_write(payment,"TotalPriceBreakdown,TotalVAT","",TotalVAT)
	func_write(payment,"TotalPriceBreakdown,TotalIPT","",TotalIPT)
	func_write(payment,"TotalPriceBreakdown,TransSubType","",TransSubType)



 //Policy Price Breakdown
def P_GrandTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:Total[1]}' )
def P_GrandTotalExcDisc = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:TotalExcludingDiscounts[1]}' )
def P_DiscTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:DiscountTotal[1]}' )
def P_BaseCoverTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:BaseCoverTotal[1]}' )
def P_BaseCoverTotalLessDisc = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:BaseCoverTotalLessDiscounts[1]}' )
def P_BaseCoverAAFTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:BaseCoverArrangementFeeTotal[1]}' )
def P_TotalAAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:TotalArrangementFee[1]}' )
def P_FeeTotal = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:SurchargeFeeTotal[1]}' )
def P_TotalLessTotalAAFAddons = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:TotalLessTotalAAFAndTotalAddons[1]}' )
def P_TotalLessFees = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:TotalLessSurchargeFees[1]}' )
def P_TotalLessAAF = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:TotalLessArrangementFees[1]}' )
def P_TotalIPT = context.expand( '${658Request#Response#declare namespace tns1=\'http://www.theaa.com/CommonServices/Data/Product.2\'; declare namespace tns3=\'http://www.theaa.com/CommonServices/Message/BS/Road/GenerateQuote_MTA.2\'; //tns3:GenerateQuoteResponse[1]/tns3:ProductList[1]/tns1:Payment[1]/tns1:PolicyTotalPriceBreakdown[1]/tns1:TotalIPT[1]}' )
func_write(payment,"Policy,CombinedTotal","",P_GrandTotal)
	func_write(payment,"Policy,TotalLessDisc","",P_GrandTotalExcDisc)
	func_write(payment,"Policy,DiscountsTotal","",P_DiscTotal)
	func_write(payment,"Policy,BaseCoverTotal","",P_BaseCoverTotal)
	func_write(payment,"Policy,BaseCoverLessDisc","",P_BaseCoverTotalLessDisc)
	func_write(payment,"Policy,BaseCoverAAFTotal","",P_BaseCoverAAFTotal)
	func_write(payment,"Policy,TotalAAF","",P_TotalAAF)
	func_write(payment,"Policy,TotalFee","",P_FeeTotal)
	func_write(payment,"Policy,TotalLessAAFLessAddons","",P_TotalLessTotalAAFAddons)
	func_write(payment,"Policy,TotalLessFee","",P_TotalLessFees)
	func_write(payment,"Policy,TotalLessAAF","",P_TotalLessAAF)
	func_write(payment,"Policy,TotalIPT","",P_TotalIPT)



def func_write (payment,element,name,RadarValue)
{
	int totalOfValuesChecked = Integer.parseInt(context.expand( '${#TestCase#TotalOfValuesChecked}' ))
	def prodType = context.expand( '${658All#NEWPRODUCT}' )

	if (context.expand('${658All#NEWBRC}') == "Y")
	{
		Car1 = context.expand( '${658All#NewCar1}' )
		Car2 = context.expand( '${658All#NewCar2}' )
		Car3 = context.expand( '${658All#NewCar3}' )
		Car4 = context.expand( '${658All#NewCar4}' )
		if (Car4 != "")
		{
			product_type = prodType + "(" + "Car1:" + Car1 + ",Car2:" + Car2 + ",Car3:" + Car3 + ",Car4:" + Car4 + ")"
		}
		else if (Car3 != "")
		{
			product_type = prodType + "(" + "Car1:" + Car1 + ",Car2:" + Car2 + ",Car3:" + Car3 + ")"
		}
		else if (Car2 != "")
		{
			product_type = prodType + "("  + "Car1:" + Car1 + ",Car2:" + Car2 + ")"
		}
		else
		{
			product_type = prodType + "(" + "Car1:" + Car1 + ")"
		}
	}
	else
	{
		product_type = context.expand( '${658All#NEWPRODUCT}' )
	}

	if (name == "BasicBreakdown" || name == "LocalDriver" ||  name == "ROCO" || name ==  "ROPOV" || name == "Standby" ||  name == "StartUp" )
	{
		 name= "Roadside"
	}
	log.info Pass=(context.expand('${658All#ID}') + "|" + context.expand( '${658All#NB/RNL Offer}' ) + "|"  + payment + "|" + product_type + "|" + context.expand( '${658All#NewCover_type}' ) + "|" + name + "|" + element + "| " + RadarValue )

	
	
	BufferedWriter bw = new BufferedWriter (new FileWriter (context.expand('${#TestCase#ResultFile}'), true));
	bw.write (Pass);
	bw.newLine();
	bw.flush();
	bw.close();
	totalOfValuesChecked++
	testRunner.testCase.setPropertyValue( 'totalOfValuesChecked',  new Integer(totalOfValuesChecked).toString())
	
}]]></script>
    </con:config>
  </con:testStep>
  <con:properties>
    <con:property>
      <con:name>ProductList_XML</con:name>
      <con:value><![CDATA[<gen:Product><prod:ProductCode>PRD_UK_0001</prod:ProductCode></gen:Product><gen:Product><prod:ProductCode>PRD_UK_0003</prod:ProductCode></gen:Product><gen:Product><prod:ProductCode>PRD_UK_0005</prod:ProductCode></gen:Product><gen:Product><prod:ProductCode>PRD_UK_0018</prod:ProductCode></gen:Product><gen:VehicleAgeList></prod:VehicleAgeList>]]></con:value>
    </con:property>
    <con:property>
      <con:name>RoadList</con:name>
      <con:value>PRD_UK_0001</con:value>
    </con:property>
    <con:property>
      <con:name>RoadNameList</con:name>
      <con:value>Roadside</con:value>
    </con:property>
    <con:property>
      <con:name>TaxType</con:name>
      <con:value>I</con:value>
    </con:property>
    <con:property>
      <con:name>Cover</con:name>
      <con:value>4</con:value>
    </con:property>
    <con:property>
      <con:name>BRCList_XML</con:name>
      <con:value/>
    </con:property>
    <con:property>
      <con:name>FeeList_XML</con:name>
      <con:value/>
    </con:property>
    <con:property>
      <con:name>Threshold_XML</con:name>
      <con:value/>
    </con:property>
    <con:property>
      <con:name>AgentDiscount_XML</con:name>
      <con:value><![CDATA[<prod:AgentDiscountRequestedList><prod:AgentDiscountRequested><prod:AgentDiscountCode>ABI1C</prod:AgentDiscountCode><prod:AgentDiscountType>M</prod:AgentDiscountType><prod:AgentDiscountValue>10</prod:AgentDiscountValue></prod:AgentDiscountRequested><prod:AgentDiscountRequested><prod:AgentDiscountCode>ABI2C</prod:AgentDiscountCode><prod:AgentDiscountType>M</prod:AgentDiscountType><prod:AgentDiscountValue>5</prod:AgentDiscountValue></prod:AgentDiscountRequested></prod:AgentDiscountRequestedList>]]></con:value>
    </con:property>
    <con:property>
      <con:name>AgentDiscountsApplied</con:name>
      <con:value>2</con:value>
    </con:property>
    <con:property>
      <con:name>MTA1_New_ProductList_XML</con:name>
      <con:value><![CDATA[<gen:Product><prod:ProductCode>PRD_UK_0001</prod:ProductCode></gen:Product><gen:Product><prod:ProductCode>PRD_UK_0003</prod:ProductCode></gen:Product><gen:Product><prod:ProductCode>PRD_UK_0005</prod:ProductCode></gen:Product><gen:Product><prod:ProductCode>PRD_UK_0018</prod:ProductCode></gen:Product><prod:VehicleAgeList><prod:VehicleAge>6</prod:VehicleAge></prod:VehicleAgeList>]]></con:value>
    </con:property>
    <con:property>
      <con:name>MTA1NEWCover</con:name>
      <con:value>3</con:value>
    </con:property>
    <con:property>
      <con:name>MTAFeeList_XML</con:name>
      <con:value/>
    </con:property>
    <con:property>
      <con:name>RiskCommunityInd</con:name>
      <con:value>Community</con:value>
    </con:property>
    <con:property>
      <con:name>Transaction</con:name>
      <con:value>Renewal</con:value>
    </con:property>
    <con:property>
      <con:name>MTAAgentDiscount_XML</con:name>
      <con:value><![CDATA[<prod:AgentDiscountRequestedList><prod:AgentDiscountRequested><prod:AgentDiscountCode>MTA1c</prod:AgentDiscountCode><prod:AgentDiscountType>T</prod:AgentDiscountType><prod:AgentDiscountValue>150</prod:AgentDiscountValue></prod:AgentDiscountRequested></prod:AgentDiscountRequestedList>]]></con:value>
    </con:property>
    <con:property>
      <con:name>RNL_Trans_MTA1_CurrentPolicyPrice_XML</con:name>
      <con:value><![CDATA[<gen:Product><prod:ProductCode>PRD_UK_0001</prod:ProductCode><prod:ProductPriceName>Roadside</prod:ProductPriceName><gen:PriceList><prod:PolicyPrice><prod:PriceElementType/><prod:PriceBreakdown><prod:CorePrice><prod:NetRate>0.0</prod:NetRate><prod:NetRateTax>0.0</prod:NetRateTax><prod:Commission>148.3</prod:Commission><prod:CommissionTax>17.8</prod:CommissionTax><prod:InternallyFundedDiscount>0.0</prod:InternallyFundedDiscount><prod:TaxPercentage>0.12</prod:TaxPercentage><prod:TaxTotal>17.8</prod:TaxTotal><prod:Total>166.1</prod:Total></prod:CorePrice><prod:ArrangementFee><prod:Fee>40.07</prod:Fee><prod:FeeTax>4.81</prod:FeeTax><prod:InternallyFundedDiscount>0.0</prod:InternallyFundedDiscount><prod:TaxPercentage>0.12</prod:TaxPercentage><prod:Total>44.88</prod:Total></prod:ArrangementFee><prod:AccountingTotals><prod:CoreDiscountsTotal>-14.32</prod:CoreDiscountsTotal><prod:CoreDiscountsTaxTotal>-1.54</prod:CoreDiscountsTaxTotal><prod:CoreCommissionDiscountsTotal>-12.78</prod:CoreCommissionDiscountsTotal><prod:CoreNetRateDiscountsTotal>0.0</prod:CoreNetRateDiscountsTotal><prod:ArrangementFeeGrandDiscountsTotal>0.0</prod:ArrangementFeeGrandDiscountsTotal><prod:ArrangementFeeTaxDiscountsTotal>0.0</prod:ArrangementFeeTaxDiscountsTotal><prod:ArrangementFeeDiscountsTotal>0.0</prod:ArrangementFeeDiscountsTotal></prod:AccountingTotals></prod:PriceBreakdown><prod:TaxType>I</prod:TaxType><prod:TaxDate>2020-02-01T00:00:00</prod:TaxDate><prod:DateInceptedOnPolicy>2020-02-01T00:00:00</prod:DateInceptedOnPolicy><prod:RelativityPriceFactor>1.0</prod:RelativityPriceFactor><prod:ExtrapolationFactor>1.0</prod:ExtrapolationFactor><prod:ArrangementFeeTotal>44.88</prod:ArrangementFeeTotal><prod:TotalLessArrangementFeeTotal>151.78</prod:TotalLessArrangementFeeTotal><prod:TotalLessDiscounts>210.98</prod:TotalLessDiscounts><prod:Total>196.66</prod:Total></prod:PolicyPrice></gen:PriceList><prod:InsideCoolingOffFlag>false</prod:InsideCoolingOffFlag><prod:FullRefundFlag>false</prod:FullRefundFlag><prod:PaidPeriods>1</prod:PaidPeriods></gen:Product><gen:Product><prod:ProductCode>PRD_UK_0003</prod:ProductCode><prod:ProductPriceName>HomeStart</prod:ProductPriceName><gen:PriceList><prod:PolicyPrice><prod:PriceElementType/><prod:PriceBreakdown><prod:CorePrice><prod:NetRate></prod:NetRate><prod:NetRateTax></prod:NetRateTax><prod:Commission></prod:Commission><prod:CommissionTax></prod:CommissionTax><prod:InternallyFundedDiscount></prod:InternallyFundedDiscount><prod:TaxPercentage></prod:TaxPercentage><prod:TaxTotal></prod:TaxTotal><prod:Total></prod:Total></prod:CorePrice><prod:ArrangementFee><prod:Fee></prod:Fee><prod:FeeTax></prod:FeeTax><prod:InternallyFundedDiscount></prod:InternallyFundedDiscount><prod:TaxPercentage></prod:TaxPercentage><prod:Total></prod:Total></prod:ArrangementFee><prod:AccountingTotals><prod:CoreDiscountsTotal></prod:CoreDiscountsTotal><prod:CoreDiscountsTaxTotal></prod:CoreDiscountsTaxTotal><prod:CoreCommissionDiscountsTotal></prod:CoreCommissionDiscountsTotal><prod:CoreNetRateDiscountsTotal></prod:CoreNetRateDiscountsTotal><prod:ArrangementFeeGrandDiscountsTotal></prod:ArrangementFeeGrandDiscountsTotal><prod:ArrangementFeeTaxDiscountsTotal></prod:ArrangementFeeTaxDiscountsTotal><prod:ArrangementFeeDiscountsTotal></prod:ArrangementFeeDiscountsTotal></prod:AccountingTotals></prod:PriceBreakdown><prod:TaxType></prod:TaxType><prod:TaxDate></prod:TaxDate><prod:DateInceptedOnPolicy></prod:DateInceptedOnPolicy><prod:RelativityPriceFactor></prod:RelativityPriceFactor><prod:ExtrapolationFactor></prod:ExtrapolationFactor><prod:ArrangementFeeTotal></prod:ArrangementFeeTotal><prod:TotalLessArrangementFeeTotal></prod:TotalLessArrangementFeeTotal><prod:TotalLessDiscounts></prod:TotalLessDiscounts><prod:Total></prod:Total></prod:PolicyPrice></gen:PriceList><prod:InsideCoolingOffFlag>false</prod:InsideCoolingOffFlag><prod:FullRefundFlag>false</prod:FullRefundFlag><prod:PaidPeriods>1</prod:PaidPeriods></gen:Product><gen:Product><prod:ProductCode>PRD_UK_0005</prod:ProductCode><prod:ProductPriceName>StayMobile</prod:ProductPriceName><gen:PriceList><prod:PolicyPrice><prod:PriceElementType/><prod:PriceBreakdown><prod:CorePrice><prod:NetRate>7.07</prod:NetRate><prod:NetRateTax>0.85</prod:NetRateTax><prod:Commission>41.96</prod:Commission><prod:CommissionTax>5.04</prod:CommissionTax><prod:InternallyFundedDiscount>0.0</prod:InternallyFundedDiscount><prod:TaxPercentage>0.12</prod:TaxPercentage><prod:TaxTotal>5.89</prod:TaxTotal><prod:Total>54.92</prod:Total></prod:CorePrice><prod:ArrangementFee><prod:Fee>8.89</prod:Fee><prod:FeeTax>1.07</prod:FeeTax><prod:InternallyFundedDiscount>0.0</prod:InternallyFundedDiscount><prod:TaxPercentage>0.12</prod:TaxPercentage><prod:Total>9.96</prod:Total></prod:ArrangementFee><prod:AccountingTotals><prod:CoreDiscountsTotal>-54.92</prod:CoreDiscountsTotal><prod:CoreDiscountsTaxTotal>-5.04</prod:CoreDiscountsTaxTotal><prod:CoreCommissionDiscountsTotal>-49.88</prod:CoreCommissionDiscountsTotal><prod:CoreNetRateDiscountsTotal>0.0</prod:CoreNetRateDiscountsTotal><prod:ArrangementFeeGrandDiscountsTotal>-9.96</prod:ArrangementFeeGrandDiscountsTotal><prod:ArrangementFeeTaxDiscountsTotal>-1.07</prod:ArrangementFeeTaxDiscountsTotal><prod:ArrangementFeeDiscountsTotal>-8.89</prod:ArrangementFeeDiscountsTotal></prod:AccountingTotals></prod:PriceBreakdown><prod:TaxType>I</prod:TaxType><prod:TaxDate>2020-02-01T00:00:00</prod:TaxDate><prod:DateInceptedOnPolicy>2020-02-01T00:00:00</prod:DateInceptedOnPolicy><prod:RelativityPriceFactor>1.0</prod:RelativityPriceFactor><prod:ExtrapolationFactor>1.0</prod:ExtrapolationFactor><prod:ArrangementFeeTotal>0.0</prod:ArrangementFeeTotal><prod:TotalLessArrangementFeeTotal>0.0</prod:TotalLessArrangementFeeTotal><prod:TotalLessDiscounts>64.88</prod:TotalLessDiscounts><prod:Total>0.0</prod:Total></prod:PolicyPrice></gen:PriceList><prod:InsideCoolingOffFlag>false</prod:InsideCoolingOffFlag><prod:FullRefundFlag>false</prod:FullRefundFlag><prod:PaidPeriods>1</prod:PaidPeriods></gen:Product>]]></con:value>
    </con:property>
    <con:property>
      <con:name>RNL_Trans_MTA1_TransPrice_XML</con:name>
      <con:value><![CDATA[<gen:TransactionProduct><prod:ProductCode>PRD_UK_0001</prod:ProductCode><prod:ProductPriceName>Roadside</prod:ProductPriceName><gen:TransactionPriceList><prod:Price><prod:PriceElementType/><prod:PriceBreakdown><prod:CorePrice><prod:NetRate>0.0</prod:NetRate><prod:NetRateTax>0.0</prod:NetRateTax><prod:Commission>43.95</prod:Commission><prod:CommissionTax>5.27</prod:CommissionTax><prod:InternallyFundedDiscount>0.0</prod:InternallyFundedDiscount><prod:TaxPercentage>0.12</prod:TaxPercentage><prod:TaxTotal>5.27</prod:TaxTotal><prod:Total>49.22</prod:Total></prod:CorePrice><prod:ArrangementFee><prod:Fee>22.29</prod:Fee><prod:FeeTax>2.67</prod:FeeTax><prod:InternallyFundedDiscount>0.0</prod:InternallyFundedDiscount><prod:TaxPercentage>0.12</prod:TaxPercentage><prod:Total>24.96</prod:Total></prod:ArrangementFee><prod:AccountingTotals><prod:CoreDiscountsTotal>0.0</prod:CoreDiscountsTotal><prod:CoreDiscountsTaxTotal>0.0</prod:CoreDiscountsTaxTotal><prod:CoreCommissionDiscountsTotal>0.0</prod:CoreCommissionDiscountsTotal><prod:CoreNetRateDiscountsTotal>0.0</prod:CoreNetRateDiscountsTotal><prod:ArrangementFeeGrandDiscountsTotal>0.0</prod:ArrangementFeeGrandDiscountsTotal><prod:ArrangementFeeTaxDiscountsTotal>0.0</prod:ArrangementFeeTaxDiscountsTotal><prod:ArrangementFeeDiscountsTotal>0.0</prod:ArrangementFeeDiscountsTotal></prod:AccountingTotals></prod:PriceBreakdown><prod:TaxType>I</prod:TaxType><prod:TaxDate>2020-02-15T00:00:00</prod:TaxDate><prod:DateInceptedOnPolicy>2020-02-15T00:00:00</prod:DateInceptedOnPolicy><prod:RelativityPriceFactor>1.0</prod:RelativityPriceFactor><prod:ExtrapolationFactor>1.0</prod:ExtrapolationFactor><prod:ArrangementFeeTotal>24.96</prod:ArrangementFeeTotal><prod:TotalLessArrangementFeeTotal>49.22</prod:TotalLessArrangementFeeTotal><prod:TotalLessDiscounts>74.18</prod:TotalLessDiscounts><prod:Total>74.18</prod:Total></prod:Price></gen:TransactionPriceList></gen:TransactionProduct><gen:TransactionProduct><prod:ProductCode>PRD_UK_0004</prod:ProductCode><prod:ProductPriceName>Relay</prod:ProductPriceName><gen:TransactionPriceList><prod:Price><prod:PriceElementType/><prod:PriceBreakdown><prod:CorePrice><prod:NetRate>0.0</prod:NetRate><prod:NetRateTax>0.0</prod:NetRateTax><prod:Commission>53.37</prod:Commission><prod:CommissionTax>6.4</prod:CommissionTax><prod:InternallyFundedDiscount>0.0</prod:InternallyFundedDiscount><prod:TaxPercentage>0.12</prod:TaxPercentage><prod:TaxTotal>6.4</prod:TaxTotal><prod:Total>59.77</prod:Total></prod:CorePrice><prod:ArrangementFee><prod:Fee>8.89</prod:Fee><prod:FeeTax>1.07</prod:FeeTax><prod:InternallyFundedDiscount>0.0</prod:InternallyFundedDiscount><prod:TaxPercentage>0.12</prod:TaxPercentage><prod:Total>9.96</prod:Total></prod:ArrangementFee><prod:OfferCodeDiscountList><prod:OfferCodeDiscount><prod:Code>AAFRRL</prod:Code><prod:DiscountApplicationApproach>Product</prod:DiscountApplicationApproach><prod:NetRate>0.0</prod:NetRate><prod:NetRateTax>0.0</prod:NetRateTax><prod:Commission>-53.37</prod:Commission><prod:CommissionTax>-6.4</prod:CommissionTax><prod:ArrangementFee>-8.89</prod:ArrangementFee><prod:ArrangementFeeTax>-1.07</prod:ArrangementFeeTax><prod:InternallyFundedDiscount>0.0</prod:InternallyFundedDiscount><prod:TaxPercentage>0.12</prod:TaxPercentage><prod:Total>-69.73</prod:Total></prod:OfferCodeDiscount></prod:OfferCodeDiscountList><prod:AccountingTotals><prod:CoreDiscountsTotal>-59.77</prod:CoreDiscountsTotal><prod:CoreDiscountsTaxTotal>-6.4</prod:CoreDiscountsTaxTotal><prod:CoreCommissionDiscountsTotal>-53.37</prod:CoreCommissionDiscountsTotal><prod:CoreNetRateDiscountsTotal>0.0</prod:CoreNetRateDiscountsTotal><prod:ArrangementFeeGrandDiscountsTotal>-9.96</prod:ArrangementFeeGrandDiscountsTotal><prod:ArrangementFeeTaxDiscountsTotal>-1.07</prod:ArrangementFeeTaxDiscountsTotal><prod:ArrangementFeeDiscountsTotal>-8.89</prod:ArrangementFeeDiscountsTotal></prod:AccountingTotals></prod:PriceBreakdown><prod:TaxType>I</prod:TaxType><prod:TaxDate>2020-02-15T00:00:00</prod:TaxDate><prod:DateInceptedOnPolicy>2020-02-15T00:00:00</prod:DateInceptedOnPolicy><prod:RelativityPriceFactor>1.0</prod:RelativityPriceFactor><prod:ExtrapolationFactor>1.0</prod:ExtrapolationFactor><prod:ArrangementFeeTotal>0.0</prod:ArrangementFeeTotal><prod:TotalLessArrangementFeeTotal>0.0</prod:TotalLessArrangementFeeTotal><prod:TotalLessDiscounts>69.73</prod:TotalLessDiscounts><prod:Total>0.0</prod:Total></prod:Price></gen:TransactionPriceList></gen:TransactionProduct><gen:TransactionProduct><prod:ProductCode>PRD_UK_0003</prod:ProductCode><prod:ProductPriceName>HomeStart</prod:ProductPriceName><gen:TransactionPriceList><prod:Price><prod:PriceElementType/><prod:PriceBreakdown><prod:CorePrice><prod:NetRate>0.0</prod:NetRate><prod:NetRateTax>0.0</prod:NetRateTax><prod:Commission>50.57</prod:Commission><prod:CommissionTax>6.07</prod:CommissionTax><prod:InternallyFundedDiscount>0.0</prod:InternallyFundedDiscount><prod:TaxPercentage>0.12</prod:TaxPercentage><prod:TaxTotal>6.07</prod:TaxTotal><prod:Total>56.64</prod:Total></prod:CorePrice><prod:ArrangementFee><prod:Fee>8.89</prod:Fee><prod:FeeTax>1.07</prod:FeeTax><prod:InternallyFundedDiscount>0.0</prod:InternallyFundedDiscount><prod:TaxPercentage>0.12</prod:TaxPercentage><prod:Total>9.96</prod:Total></prod:ArrangementFee><prod:AccountingTotals><prod:CoreDiscountsTotal>0.0</prod:CoreDiscountsTotal><prod:CoreDiscountsTaxTotal>0.0</prod:CoreDiscountsTaxTotal><prod:CoreCommissionDiscountsTotal>0.0</prod:CoreCommissionDiscountsTotal><prod:CoreNetRateDiscountsTotal>0.0</prod:CoreNetRateDiscountsTotal><prod:ArrangementFeeGrandDiscountsTotal>0.0</prod:ArrangementFeeGrandDiscountsTotal><prod:ArrangementFeeTaxDiscountsTotal>0.0</prod:ArrangementFeeTaxDiscountsTotal><prod:ArrangementFeeDiscountsTotal>0.0</prod:ArrangementFeeDiscountsTotal></prod:AccountingTotals></prod:PriceBreakdown><prod:TaxType>I</prod:TaxType><prod:TaxDate>2020-02-15T00:00:00</prod:TaxDate><prod:DateInceptedOnPolicy>2020-02-15T00:00:00</prod:DateInceptedOnPolicy><prod:RelativityPriceFactor>0.7151</prod:RelativityPriceFactor><prod:ExtrapolationFactor>1.0</prod:ExtrapolationFactor><prod:ArrangementFeeTotal>9.96</prod:ArrangementFeeTotal><prod:TotalLessArrangementFeeTotal>56.64</prod:TotalLessArrangementFeeTotal><prod:TotalLessDiscounts>66.6</prod:TotalLessDiscounts><prod:Total>66.6</prod:Total></prod:Price></gen:TransactionPriceList></gen:TransactionProduct>]]></con:value>
    </con:property>
    <con:property>
      <con:name>TotalOfValuesChecked</con:name>
      <con:value>0</con:value>
    </con:property>
    <con:property>
      <con:name>NumOfIterations</con:name>
      <con:value>0</con:value>
    </con:property>
    <con:property>
      <con:name>RequestDateTime</con:name>
      <con:value>2020-02-08T00:00:00</con:value>
    </con:property>
    <con:property>
      <con:name>PolicyStartDateTime</con:name>
      <con:value>2019-03-17T00:00:00</con:value>
    </con:property>
    <con:property>
      <con:name>PolicyEndDateTime</con:name>
      <con:value>2020-03-16T00:00:00</con:value>
    </con:property>
    <con:property>
      <con:name>TaxDateTime</con:name>
      <con:value>2019-04-17T00:00:00</con:value>
    </con:property>
    <con:property>
      <con:name>PriceDate</con:name>
      <con:value>2019-04-17T00:00:00</con:value>
    </con:property>
    <con:property>
      <con:name>FeesDate</con:name>
      <con:value>2019-04-17T00:00:00</con:value>
    </con:property>
    <con:property>
      <con:name>File</con:name>
      <con:value>N:/Systems_development/RIO/Road Renewals/Soap UI/Test Results/408RNLTransE2EResults-MTA20190515T160230.txt</con:value>
    </con:property>
    <con:property>
      <con:name>ProductTotalResultFile</con:name>
      <con:value>N:/Systems_development/RIO/Road MTA-CR-242/Soap UI/Test Results/408NBR/ProductTotalNBRresults20190529T124153.txt</con:value>
    </con:property>
    <con:property>
      <con:name>PolicyTotalResultFile</con:name>
      <con:value>N:/Systems_development/RIO/Road MTA-CR-242/Soap UI/Test Results/408NBR/PolicyTotalNBRresults20190529T124153.txt</con:value>
    </con:property>
    <con:property>
      <con:name>DiscTotalResultFile</con:name>
      <con:value>N:/Systems_development/RIO/Road MTA-CR-242/Soap UI/Test Results/408NBR/DiscTotalNBRresults20190529T124153.txt</con:value>
    </con:property>
    <con:property>
      <con:name>payment</con:name>
      <con:value>CMM</con:value>
    </con:property>
    <con:property>
      <con:name>ResultFile</con:name>
      <con:value>N:/Systems_development/RIO/Road MTA-CR-242/Soap UI/Test Results/RCR-658/Results20200124T135259.txt</con:value>
    </con:property>
  </con:properties>
  <con:reportParameters/>
  <con:breakPoints>
    <con:testStepId>69cf8be6-1020-406e-8767-7dae173a9244</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>58d4d2f7-ecf9-4f2a-a4c6-765bb1501fac</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>109ef6a5-a9cb-45c6-8bf1-697b0cfcdcc2</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>f641bd6c-e8f4-4bde-a591-4740f0eb2ae0</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>e5e597af-1b93-4325-b8b5-445158abcdd8</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>cbc813e3-c325-4078-a248-80deae0e4011</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>b983778c-ff91-4200-a8c0-d08bb3c62e19</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
  <con:breakPoints>
    <con:testStepId>7f0dfa33-f817-4c34-9c3e-10af7ebd630f</con:testStepId>
    <con:status>NONE</con:status>
    <con:properties/>
  </con:breakPoints>
</con:testCase>
